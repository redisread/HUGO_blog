---
title: "Pytorch Begin"
date: 2020-02-22T22:49:28+08:00
description:
draft: false
hideToc: false
enableToc: true
enableTocContent: false
tocPosition: inner
author: Victor
authorEmoji: ğŸ‘»
image: https://i.loli.net/2020/02/22/mW367ipBfFEyecD.png
tags:
- PyTorch
- python
- Tensor
series:
- æ·±åº¦å­¦ä¹ 
categories:
-
---



é‡æ–°å­¦ä¹ ä¸€ä¸‹DLï¼Œè¿™æ¬¡ä½¿ç”¨PyTorchæ¡†æ¶:flashlight:

<!--more-->

> å‚è€ƒèµ„æ–™ï¼š
>
> https://github.com/dsgiitr/d2l-pytorch
>
> ![](https://i.loli.net/2020/02/22/QhYs29c7nNEumP3.png)

### å¯¼å…¥PyTorchåº“


```python
import torch
import numpy as np
```

### åˆ›å»ºTensor

5x3çš„æœªåˆå§‹åŒ–çš„å¼ é‡


```python
x = torch.empty(5,3)
x
```




    tensor([[1.0286e-38, 9.0919e-39, 8.9082e-39],
            [9.2755e-39, 8.4490e-39, 1.0194e-38],
            [9.0919e-39, 8.4490e-39, 8.7245e-39],
            [1.0102e-38, 1.0653e-38, 8.7245e-39],
            [1.0286e-38, 9.6429e-39, 4.2244e-39]])



5x3éšæœºåˆå§‹åŒ–çš„å¼ é‡


```python
x = torch.rand(5,3)
x
```




    tensor([[0.2518, 0.0419, 0.3233],
            [0.1493, 0.1408, 0.8559],
            [0.5145, 0.4648, 0.4605],
            [0.2555, 0.2502, 0.4506],
            [0.9798, 0.5056, 0.2726]])



5x3å…¨0çš„å¼ é‡


```python
x = torch.zeros(5,3) # å¯ä»¥æŒ‡å®šç±»å‹ x = torch.zeros(5,3,dtype=torch.long)
x
```




    tensor([[0., 0., 0.],
            [0., 0., 0.],
            [0., 0., 0.],
            [0., 0., 0.],
            [0., 0., 0.]])



æ•°æ®å¼ é‡


```python
x = torch.tensor([5.5,3])
x
```




    tensor([5.5000, 3.0000])



é»˜è®¤åˆ›å»ºå’ŒåŸæ¥çš„å¼ é‡ä¸€æ ·çš„dtypeå’Œdeviceçš„å¼ é‡ï¼Œä¹Ÿå¯ä»¥å¦å¤–è®¾ç½®


```python
x = x.new_ones(5,3,dtype=torch.double)
print(x)
x = torch.randn_like(x,dtype=torch.float)
print(x)
```

    tensor([[1., 1., 1.],
            [1., 1., 1.],
            [1., 1., 1.],
            [1., 1., 1.],
            [1., 1., 1.]], dtype=torch.float64)
    tensor([[-0.7829, -0.4010,  0.3230],
            [ 0.2660,  0.4766,  0.3186],
            [ 0.6096,  1.1226, -1.7942],
            [ 1.3255,  0.1835, -0.9078],
            [ 1.7743, -0.0944, -0.1704]])


è·å–Tensorçš„å½¢çŠ¶


```python
x.shape,x.size()
```




    (torch.Size([5, 3]), torch.Size([5, 3]))



å…¶ä»–åˆ›å»ºTensorçš„å‡½æ•°:

| å‡½æ•°                              | åŠŸèƒ½                      |
| --------------------------------- | ------------------------- |
| Tensor(*sizes)                    | åŸºç¡€æ„é€ å‡½æ•°              |
| tensor(data,)                     | ç±»ä¼¼np.arrayçš„æ„é€ å‡½æ•°    |
| ones(*sizes)                      | å…¨1Tensor                 |
| zeros(*sizes)                     | å…¨0Tensor                 |
| eye(*sizes)                       | å¯¹è§’çº¿ä¸º1ï¼Œå…¶ä»–ä¸º0        |
| arange(s,e,step)                  | ä»såˆ°eï¼Œæ­¥é•¿ä¸ºstep        |
| linspace(s,e,steps)               | ä»såˆ°eï¼Œå‡åŒ€åˆ‡åˆ†æˆstepsä»½ |
| rand/randn(*sizes)                | å‡åŒ€/æ ‡å‡†åˆ†å¸ƒ             |
| normal(mean,std)/uniform(from,to) | æ­£æ€åˆ†å¸ƒ/å‡åŒ€åˆ†å¸ƒ         |
| randperm(m)                       | éšæœºæ’åˆ—                  |

> è¿™äº›åˆ›å»ºæ–¹æ³•éƒ½å¯ä»¥åœ¨åˆ›å»ºçš„æ—¶å€™æŒ‡å®šæ•°æ®ç±»å‹dtypeå’Œå­˜æ”¾device(cpu/gpu)


### æ“ä½œ


```python
x = torch.rand(5,3)
y = torch.rand(5,3)
x,y
```




    (tensor([[0.7706, 0.7674, 0.0476],
             [0.3675, 0.3652, 0.1215],
             [0.2842, 0.4927, 0.0903],
             [0.1202, 0.7635, 0.1862],
             [0.1391, 0.5023, 0.0580]]),
     tensor([[0.2149, 0.4744, 0.6664],
             [0.5948, 0.3451, 0.6485],
             [0.2303, 0.6660, 0.3796],
             [0.7194, 0.3815, 0.7536],
             [0.7886, 0.0630, 0.2459]]))



åŠ æ³•ï¼Œä¸‰ç§æ–¹æ³•


```python
z1 = torch.add(x,y)
z2 = x.add_(y)  # xä¼šæ”¹å˜
z3 = x + y
z1,z2,z3
```




    (tensor([[0.9855, 1.2418, 0.7140],
             [0.9623, 0.7103, 0.7700],
             [0.5145, 1.1588, 0.4699],
             [0.8396, 1.1450, 0.9397],
             [0.9276, 0.5653, 0.3040]]),
     tensor([[0.9855, 1.2418, 0.7140],
             [0.9623, 0.7103, 0.7700],
             [0.5145, 1.1588, 0.4699],
             [0.8396, 1.1450, 0.9397],
             [0.9276, 0.5653, 0.3040]]),
     tensor([[1.2004, 1.7163, 1.3804],
             [1.5571, 1.0554, 1.4185],
             [0.7448, 1.8248, 0.8495],
             [1.5590, 1.5265, 1.6933],
             [1.7162, 0.6283, 0.5499]]))



ç´¢å¼•


```python
y = x[0, :]
y
```




    tensor([0.9855, 1.2418, 0.7140])



ä¿®æ”¹yä¼šä¿®æ”¹åŸæ¥çš„æ•°æ®ï¼Œå› ä¸ºå…±äº«å†…å­˜


```python
y+=1
print(y)
print(x[0,:])
```

    tensor([1.9855, 2.2418, 1.7140])
    tensor([1.9855, 2.2418, 1.7140])


PyTorchè¿˜æä¾›äº†ä¸€äº›é«˜çº§çš„é€‰æ‹©å‡½æ•°:

| å‡½æ•°                            | åŠŸèƒ½                                                  |
| ------------------------------- | ----------------------------------------------------- |
| index_select(input, dim, index) | åœ¨æŒ‡å®šç»´åº¦dimä¸Šé€‰å–ï¼Œæ¯”å¦‚é€‰å–æŸäº›è¡Œã€æŸäº›åˆ—           |
| masked_select(input, mask)      | ä¾‹å­å¦‚ä¸Šï¼Œa[a>0]ï¼Œä½¿ç”¨ByteTensorè¿›è¡Œé€‰å–              |
| nonzero(input)                  | é0å…ƒç´ çš„ä¸‹æ ‡                                         |
| gather(input, dim, index)       | æ ¹æ®indexï¼Œåœ¨dimç»´åº¦ä¸Šé€‰å–æ•°æ®ï¼Œè¾“å‡ºçš„sizeä¸indexä¸€æ · |

### æ”¹å˜å½¢çŠ¶

ç”¨view()æ¥æ”¹å˜Tensorçš„å½¢çŠ¶ï¼š


```python
y = x.view(15)
z = x.view(-1,5)    # -1ä¸ºè‡ªåŠ¨è®¡ç®—ç»´åº¦
print(x.size(),y.size(),z.size())
```

    torch.Size([5, 3]) torch.Size([15]) torch.Size([3, 5])


> æ³¨æ„view()è¿”å›çš„æ–°Tensorä¸æºTensorè™½ç„¶å¯èƒ½æœ‰ä¸åŒçš„sizeï¼Œä½†æ˜¯æ˜¯å…±äº«dataçš„ï¼Œä¹Ÿå³æ›´æ”¹å…¶ä¸­çš„ä¸€ä¸ªï¼Œå¦å¤–ä¸€ä¸ªä¹Ÿä¼šè·Ÿç€æ”¹å˜ã€‚(é¡¾åæ€ä¹‰ï¼Œviewä»…ä»…æ˜¯æ”¹å˜äº†å¯¹è¿™ä¸ªå¼ é‡çš„è§‚å¯Ÿè§’åº¦ï¼Œå†…éƒ¨æ•°æ®å¹¶æœªæ”¹å˜)


```python
x += 1
x,y
```




    (tensor([[4.9855, 5.2418, 4.7140],
             [3.9623, 3.7103, 3.7700],
             [3.5145, 4.1588, 3.4699],
             [3.8396, 4.1450, 3.9397],
             [3.9276, 3.5653, 3.3040]]),
     tensor([4.9855, 5.2418, 4.7140, 3.9623, 3.7103, 3.7700, 3.5145, 4.1588, 3.4699,
             3.8396, 4.1450, 3.9397, 3.9276, 3.5653, 3.3040]))



ä½¿ç”¨reshape()å‡½æ•°ä¼šæ‹·è´ä¸€ä»½


```python
y = x.reshape(15)
y
```




    tensor([4.9855, 5.2418, 4.7140, 3.9623, 3.7103, 3.7700, 3.5145, 4.1588, 3.4699,
            3.8396, 4.1450, 3.9397, 3.9276, 3.5653, 3.3040])



ä¹Ÿå¯ä»¥ä½¿ç”¨å…‹éš†åview

> ä½¿ç”¨cloneè¿˜æœ‰ä¸€ä¸ªå¥½å¤„æ˜¯ä¼šè¢«è®°å½•åœ¨è®¡ç®—å›¾ä¸­ï¼Œå³æ¢¯åº¦å›ä¼ åˆ°å‰¯æœ¬æ—¶ä¹Ÿä¼šä¼ åˆ°æºTensorã€‚


```python
y = x.clone().view(15)
y
```




    tensor([4.9855, 5.2418, 4.7140, 3.9623, 3.7103, 3.7700, 3.5145, 4.1588, 3.4699,
            3.8396, 4.1450, 3.9397, 3.9276, 3.5653, 3.3040])



item(), å®ƒå¯ä»¥å°†ä¸€ä¸ªæ ‡é‡Tensorè½¬æ¢æˆä¸€ä¸ªPython numberï¼š


```python
x = torch.randn(1)
print(x)
print(x.item())
```

    tensor([0.3816])
    0.3816383183002472


### çº¿æ€§ä»£æ•°API

| å‡½æ•°                              | åŠŸèƒ½                              |
| --------------------------------- | --------------------------------- |
| trace                             | å¯¹è§’çº¿å…ƒç´ ä¹‹å’Œ(çŸ©é˜µçš„è¿¹)          |
| diag                              | å¯¹è§’çº¿å…ƒç´                         |
| triu/tril                         | çŸ©é˜µçš„ä¸Šä¸‰è§’/ä¸‹ä¸‰è§’ï¼Œå¯æŒ‡å®šåç§»é‡ |
| mm/bmm                            | çŸ©é˜µä¹˜æ³•ï¼Œbatchçš„çŸ©é˜µä¹˜æ³•         |
| addmm/addbmm/addmv/addr/baddbmm.. | çŸ©é˜µè¿ç®—                          |
| t                                 | è½¬ç½®                              |
| dot/cross                         | å†…ç§¯/å¤–ç§¯                         |
| inverse                           | æ±‚é€†çŸ©é˜µ                          |
| svd                               | å¥‡å¼‚å€¼åˆ†è§£                        |

### å¹¿æ’­æœºåˆ¶

ä»€ä¹ˆæ˜¯å¹¿æ’­æœºåˆ¶ï¼Ÿç®€å•çš„è¯´å°±æ˜¯å½¢çŠ¶ä¸åŒçš„è¿ç®—ä¼šè‡ªåŠ¨å˜æ¢ä¸ºé€‚åˆçš„è¿ç®—


```python
x = torch.arange(3).view(1,3)
print(x)
y = torch.arange(2).view(2,1)
print(y)
print(x + y)
```

    tensor([[0, 1, 2]])
    tensor([[0],
            [1]])
    tensor([[0, 1, 2],
            [1, 2, 3]])

