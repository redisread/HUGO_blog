---
title: 5-ä¾èµ–æ³¨å…¥ä¼˜äºç¡¬è¿æ¥èµ„æº
date: 2021-10-21T15:25:15+08:00
description: Prefer dependency injection to hardwiring resources.
draft: true
hideToc: false
enableToc: true
enableTocContent: false
tocPosition: outer
author: Victor
authorEmoji: ğŸª¶
image:
plantuml: true
libraries:
- katex
- mathjax
tags:
- EffectiveJava
series:
- EffectiveJava
categories:
-
---



<!--ç¬¬äºŒç« ï¼šåˆ›å»ºå’Œé”€æ¯å¯¹è±¡-->



### ä»€ä¹ˆæ˜¯ç¡¬è¿æ¥èµ„æº

ç¡¬è¿æ¥èµ„æºï¼Œæˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºï¼Œä¸€ä¸ªç±»ï¼Œä¾èµ–å…¶å®ƒåŸºç¡€ç±»ï¼Œä½†æ˜¯è¿‡äºç†æƒ³åŒ–ï¼ŒæŒ‡å®šäº†å®ƒåªè¿æ¥ä¸€ä¸ªåŸºç¡€ç±»ã€‚



### ä»€ä¹ˆæ˜¯ä¾èµ–æ³¨å…¥

å°†ç±»ä¸­ä¾èµ–çš„æŸç§æ•°æ®é€šè¿‡æŸç§æ–¹æ³•æ³¨å…¥ä¼ è¾“è¿‡å»ï¼Œè¿™å°±æ˜¯ä¾èµ–æ³¨å…¥ã€‚

![ä¾èµ–æ³¨å…¥](https://cos.jiahongw.com/uPic/image-20211021165816377.png)

### å¦‚ä½•å®ç°ä¾èµ–æ³¨å…¥

å‡å¦‚ï¼Œæ‹¼å†™æ£€æŸ¥ç¨‹åºä¾èµ–äºå­—å…¸ã€‚å¸¸è§åšæ³•æ˜¯ï¼Œå°†è¿™ç§ç±»å®ç°ä¸ºé™æ€å®ç”¨å·¥å…·ç±»

```java
// Inappropriate use of static utility - inflexible & untestable!
public class SpellChecker {
    private static final Lexicon dictionary = ...;
    private SpellChecker() {} // Noninstantiable
    public static boolean isValid(String word) { ... }
    public static List<String> suggestions(String typo) { ... }
}
```

ä¸Šé¢è®²å­—å…¸ç›´æ¥è®¾ç½®æˆäº†é™æ€çš„ä¸å¯å˜çš„æˆå‘˜ï¼Œåç»­å°†ä¸èƒ½è¿›è¡Œæ›´æ”¹ï¼Œæ‹“å±•æ€§å¾ˆå·®ã€‚é™¤éæ˜¯ä¹‹åéƒ½ä¸ä¼šæ”¹å˜è¿™ä¸ªå­—å…¸ï¼Œä½†æ˜¯ï¼Œå­—å…¸æ˜¯æœ‰å¾ˆå¤šç§çš„ã€‚

è¦æ˜¯æ¢æˆå•ä¾‹æ¨¡å¼ï¼Œå…¶å®ä¹Ÿæ˜¯æ¢æ±¤ä¸æ¢è¯ï¼Œå•ä¾‹åªæœ‰ä¸€ä¸ªï¼Œä¹Ÿæ˜¯ä¸èƒ½ä¿®æ”¹å†…å®¹çš„ã€‚

```java
// Inappropriate use of singleton - inflexible & untestable!
public class SpellChecker {
    private final Lexicon dictionary = ...;
    private SpellChecker(...) {}
    public static INSTANCE = new SpellChecker(...);
    public boolean isValid(String word) { ... }
    public List<String> suggestions(String typo) { ... }
}
```

> è¿™é‡Œä¹Ÿè¯´æ˜äº†å•ä¾‹æ¨¡å¼å…¶å®æ²¡æœ‰é‚£ä¹ˆå¥½ï¼Œå®ç°äº†å•ä¾‹å°±æ„å‘³ç€å¤±å»äº†æŠ½è±¡ï¼Œå¤šæ€ã€ç»§æ‰¿ç­‰åŠŸèƒ½ã€‚



ä½ å¯ä»¥å°è¯•è®© SpellChecker æ”¯æŒå¤šä¸ªå­—å…¸ï¼šé¦–å…ˆå–æ¶ˆ dictionary å­—æ®µçš„ final ä¿®é¥°ï¼Œå¹¶åœ¨ç°æœ‰çš„æ‹¼å†™æ£€æŸ¥å™¨ä¸­æ·»åŠ æ›´æ”¹ dictionary çš„æ–¹æ³•ã€‚ä½†æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­è¿™ç§åšæ³•æ˜¯ç¬¨æ‹™çš„ã€å®¹æ˜“å‡ºé”™çš„å’Œä¸å¯è¡Œçš„ã€‚**é™æ€å®ç”¨å·¥å…·ç±»å’Œå•ä¾‹ä¸é€‚ç”¨äºç”±åº•å±‚èµ„æºå‚æ•°åŒ–çš„ç±»ã€‚**

> æœ€å¥½æ–¹æ³•å°±æ˜¯ä¸ä½¿ç”¨é™æ€æ–¹æ³•ã€‚ä¹Ÿä¸å°†å†…éƒ¨çš„å‚æ•°å†™æ­»ã€‚



å›åˆ°æœ€åˆçš„åŠæ³•ï¼Œæ»¡è¶³æ­¤è¦æ±‚çš„ä¸€ä¸ªç®€å•æ¨¡å¼æ˜¯åœ¨**åˆ›å»ºæ–°å®ä¾‹æ—¶å°†èµ„æºä¼ é€’ç»™æ„é€ å‡½æ•°ã€‚** è¿™æ˜¯ä¾èµ–æ³¨å…¥çš„ä¸€ç§å½¢å¼ï¼šå­—å…¸æ˜¯æ‹¼å†™æ£€æŸ¥å™¨çš„ä¾èµ–é¡¹ï¼Œåœ¨åˆ›å»ºå®ƒæ—¶è¢«æ³¨å…¥åˆ°æ‹¼å†™æ£€æŸ¥å™¨ä¸­ã€‚

> ä¾èµ–æ³¨å…¥æ¨¡å¼éå¸¸ç®€å•ï¼Œè®¸å¤šç¨‹åºå‘˜åœ¨ä¸çŸ¥é“å…¶åç§°çš„æƒ…å†µä¸‹ä½¿ç”¨äº†å¤šå¹´ã€‚è™½ç„¶æ‹¼å†™æ£€æŸ¥å™¨ç¤ºä¾‹åªæœ‰ä¸€ä¸ªèµ„æºï¼ˆå­—å…¸ï¼‰ï¼Œä½†æ˜¯ä¾èµ–æ³¨å…¥å¯ä»¥å¤„ç†ä»»æ„æ•°é‡çš„èµ„æºå’Œä»»æ„ä¾èµ–è·¯å¾„ã€‚å®ƒä¿æŒäº†ä¸å¯å˜æ€§ï¼Œå› æ­¤å¤šä¸ªå®¢æˆ·ç«¯å¯ä»¥å…±äº«ä¾èµ–å¯¹è±¡ï¼ˆå‡è®¾å®¢æˆ·ç«¯éœ€è¦ç›¸åŒçš„åº•å±‚èµ„æºï¼‰ã€‚ä¾èµ–æ³¨å…¥åŒæ ·é€‚ç”¨äºæ„é€ å‡½æ•°ã€é™æ€å·¥å‚ï¼ˆ[Item-1](https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/blob/dev/Chapter-2/Chapter-2-Item-1-Consider-static-factory-methods-instead-of-constructors.md)ï¼‰å’Œæ„å»ºå™¨ï¼ˆ[Item-2](https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/blob/dev/Chapter-2/Chapter-2-Item-2-Consider-a-builder-when-faced-with-many-constructor-parameters.md)ï¼‰ã€‚

```java
// Dependency injection provides flexibility and testability
public class SpellChecker {
    private final Lexicon dictionary;
    public SpellChecker(Lexicon dictionary) {
        this.dictionary = Objects.requireNonNull(dictionary);
    }
    public boolean isValid(String word) { ... }
    public List<String> suggestions(String typo) { ... }
}
```

**è¿™ç§æ¨¡å¼çš„ä¸€ä¸ªæœ‰ç”¨å˜ä½“æ˜¯å°†èµ„æºå·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°**ã€‚å·¥å‚æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥åå¤è°ƒç”¨å®ƒæ¥åˆ›å»ºç±»å‹çš„å®ä¾‹ã€‚è¿™æ ·çš„å·¥å‚ä½“ç°äº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚

```java
Mosaic create(Supplier<? extends Tile> tileFactory) { ... }
```

> Java 8 ä¸­å¼•å…¥çš„ `Supplier<T>` éå¸¸é€‚åˆè¡¨ç¤ºå·¥å‚



**å°½ç®¡ä¾èµ–æ³¨å…¥æå¤§åœ°æé«˜äº†çµæ´»æ€§å’Œå¯æµ‹è¯•æ€§ï¼Œä½†å®ƒå¯èƒ½ä¼šä½¿å¤§å‹é¡¹ç›®å˜å¾—æ··ä¹±ï¼Œè¿™äº›é¡¹ç›®é€šå¸¸åŒ…å«æ•°åƒä¸ªä¾èµ–é¡¹ã€‚é€šè¿‡ä½¿ç”¨ä¾èµ–æ³¨å…¥æ¡†æ¶ï¼ˆå¦‚ Daggerã€Guice æˆ– Springï¼‰ï¼Œå‡ ä¹å¯ä»¥æ¶ˆé™¤è¿™ç§æ··ä¹±ã€‚**



æ€»ä¹‹ï¼Œ**ä¸è¦ä½¿ç”¨å•ä¾‹æˆ–é™æ€å®ç”¨å·¥å…·ç±»æ¥å®ç°ä¾èµ–äºä¸€ä¸ªæˆ–å¤šä¸ªåº•å±‚èµ„æºçš„ç±»**ï¼Œè¿™äº›èµ„æºçš„è¡Œä¸ºä¼šå½±å“ç±»çš„è¡Œä¸ºï¼Œ**ä¹Ÿä¸è¦è®©ç±»ç›´æ¥åˆ›å»ºè¿™äº›èµ„æº**ã€‚ç›¸åï¼Œå°†åˆ›å»ºå®ƒä»¬çš„èµ„æºæˆ–å·¥å‚ä¼ é€’ç»™æ„é€ å‡½æ•°ï¼ˆæˆ–é™æ€å·¥å‚æˆ–æ„å»ºå™¨ï¼‰ã€‚è¿™ç§æ“ä½œç§°ä¸ºä¾èµ–æ³¨å…¥ï¼Œå®ƒå°†å¤§å¤§å¢å¼ºç±»çš„çµæ´»æ€§ã€å¯å¤ç”¨æ€§å’Œå¯æµ‹è¯•æ€§ã€‚

æƒ³è¦å®ç°ä¾èµ–æ³¨å…¥ï¼Œæœ€å¥½ä½¿ç”¨ä¸€äº›æ¡†æ¶ï¼Œé¿å…é‡å¤é€ è½®å­ã€‚



---

***Reference***:

1. [ 05.ä¾èµ–æ³¨å…¥ä¼˜å…ˆäºç¡¬è¿æ¥èµ„æº_é¾šå›½ç®çš„åšå®¢-CSDNåšå®¢_ä½¿ç”¨ä¾èµ–æ³¨å…¥å–ä»£ç¡¬è¿æ¥èµ„æº](https://blog.csdn.net/qq_42678694/article/details/103949645)
2. [ JAVA8 Supplieræ¥å£_é¸­é¸­çš„åšå®¢-CSDNåšå®¢_java supplier](https://blog.csdn.net/qq_28410283/article/details/80625482)

