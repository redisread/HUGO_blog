---
title: 10-è¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®š
date: 2021-10-28T10:06:09+08:00
description:
draft: true
hideToc: false
enableToc: true
enableTocContent: false
tocPosition: outer
author: Victor
authorEmoji: ğŸª¶
image:
plantuml: true
libraries:
- katex
- mathjax
tags:
- EffectiveJava
series:
- EffectiveJava
categories:
-
---



<!--ç¬¬ä¸‰ç« ï¼šå¯¹è±¡çš„é€šç”¨æ–¹æ³•-->



### ä»€ä¹ˆæ—¶å€™ä¼šä½¿ç”¨åˆ°equal?

`equal` ç”¨äºåˆ¤æ–­ä¸¤ä¸ªå¯¹è±¡å®ä¾‹çš„æ˜¯å¦ç›¸ç­‰ã€‚è€Œ`==`è¡¨ç¤ºåˆ¤æ–­ä¿©ä¸ªå¯¹è±¡æ˜¯ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡(æ¯”è¾ƒçš„æ˜¯å¼•ç”¨çš„åœ°å€æ˜¯ä¸æ˜¯ä¸€æ ·çš„)ã€‚

æ²¡æœ‰é‡å†™`equal`æ–¹æ³•çš„æ—¶å€™ï¼Œç±»çš„æ¯ä¸ªå®ä¾‹éƒ½åªç­‰äºå®ƒè‡ªå·±ã€‚

ä¾‹å¦‚ï¼Œ`List.contains`æ–¹æ³•å°±ä½¿ç”¨äº†equalæ–¹æ³•ï¼š

![List.contains](https://cos.jiahongw.com/uPic/image-20211029112540381.png)





### ä»€ä¹ˆæ—¶å€™åº”è¯¥è¦†ç›–equalæ–¹æ³•

å½“ä½ æƒ³è¦æ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡é‡Œé¢çš„å€¼æ˜¯å¦ç›¸ç­‰ï¼Œè€Œä¸æ˜¯ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ªçš„æƒ…å†µã€‚ä½ éœ€è¦é‡å†™ä¸€ä¸ªequalæ–¹æ³•æ¥ä½“ç°ä½ çš„ä¸šåŠ¡é€»è¾‘ã€‚

> è¦†ç›– equals æ–¹æ³•ä¸ä»…æ˜¯ä¸ºäº†æ»¡è¶³ç¨‹åºå‘˜çš„æœŸæœ›ï¼Œå®ƒè¿˜ä½¿å®ä¾‹èƒ½å¤Ÿä½œä¸º Map çš„é”®æˆ– Set å…ƒç´ æ—¶ï¼Œå…·æœ‰å¯é¢„æµ‹çš„ã€ç†æƒ³çš„è¡Œä¸ºã€‚

ä¾‹å¦‚ä¸‹é¢ä¸¤ä¸ªä¾‹å­ï¼š

å‰è€…equalsæ¯”è¾ƒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ˜¯åŒä¸€ä¸ª

```java
public static void main(String[] args) {

    class Status {
        public String status;
    }

    Status s1 = new Status();
    Status s2 = new Status();

    System.out.println(s1==s2); // false
    System.out.println(s1.equals(s2)); // false
}
```

åè€…æ¯”è¾ƒçš„æ˜¯ä¸¤ä¸ªå¯¹è±¡é‡Œé¢çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚

```java
public static void main(String[] args) {

    class Status {
        public String status;

        @Override
        public boolean equals(Object o) {
            return Objects.equals(status, ((Status) o).status);
        }
    }

    Status s1 = new Status();
    Status s2 = new Status();

    System.out.println(s1==s2); // false
    System.out.println(s1.equals(s2)); // true
}
```



### è¦†ç›–equalçš„è§„å®š

1. è‡ªåæ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å‚è€ƒå€¼ xï¼Œ`x.equals(x)` å¿…é¡»è¿”å› trueã€‚
2. å¯¹ç§°æ€§ï¼šå¯¹äºä»»ä½•éç©ºå‚è€ƒå€¼ x å’Œ yï¼Œ`x.equals(y)` å¿…é¡»åœ¨ä¸”ä»…å½“ `y.equals(x)` è¿”å› true æ—¶è¿”å› trueã€‚
3. ä¼ é€’æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å¼•ç”¨å€¼ x, y, zï¼Œå¦‚æœ `x.equals(y)` è¿”å› trueï¼Œ`y.equals(z)` è¿”å› trueï¼Œé‚£ä¹ˆ `x.equals(z)` å¿…é¡»è¿”å› trueã€‚
4. ä¸€è‡´æ€§ï¼šå¯¹äºä»»ä½•éç©ºçš„å¼•ç”¨å€¼ x å’Œ y, `x.equals(y)` çš„å¤šæ¬¡è°ƒç”¨å¿…é¡»ä¸€è‡´åœ°è¿”å› true æˆ–ä¸€è‡´åœ°è¿”å› falseï¼Œå‰ææ˜¯ä¸ä¿®æ”¹ equals ä¸­ä½¿ç”¨çš„ä¿¡æ¯ã€‚

> å¯¹äºä»»ä½•éç©ºå¼•ç”¨å€¼ xï¼Œ`x.equals(null)` å¿…é¡»è¿”å› falseã€‚



é«˜è´¨é‡æ„å»º equals æ–¹æ³•çš„ç§˜è¯€ï¼š

1. ä½¿ç”¨ `==` è¿ç®—ç¬¦æ£€æŸ¥å‚æ•°æ˜¯å¦æ˜¯å¯¹è¯¥å¯¹è±¡çš„å¼•ç”¨ã€‚ 
2. ä½¿ç”¨ `instanceof` è¿ç®—ç¬¦æ£€æŸ¥å‚æ•°æ˜¯å¦å…·æœ‰æ­£ç¡®çš„ç±»å‹ã€‚
3. å°†å‚æ•°è½¬æ¢ä¸ºæ­£ç¡®çš„ç±»å‹ã€‚

4. å¯¹äºç±»ä¸­çš„æ¯ä¸ªã€Œé‡è¦ã€å­—æ®µï¼Œæ£€æŸ¥å‚æ•°çš„å­—æ®µæ˜¯å¦ä¸è¯¥å¯¹è±¡çš„ç›¸åº”å­—æ®µåŒ¹é…ã€‚ 



equals æ–¹æ³•çš„æ€§èƒ½å¯èƒ½ä¼šå—åˆ°å­—æ®µæ¯”è¾ƒé¡ºåºçš„å½±å“ã€‚ä¸ºäº†è·å¾—æœ€ä½³æ€§èƒ½ï¼Œä½ åº”è¯¥é¦–å…ˆæ¯”è¾ƒé‚£äº›æ›´å¯èƒ½ä¸åŒã€æ¯”è¾ƒæˆæœ¬æ›´ä½çš„å­—æ®µï¼Œæˆ–è€…ç†æƒ³æƒ…å†µä¸‹ä¸¤è€…éƒ½æ¯”è¾ƒã€‚ä¸èƒ½æ¯”è¾ƒä¸å±äºå¯¹è±¡é€»è¾‘çŠ¶æ€çš„å­—æ®µï¼Œä¾‹å¦‚ç”¨äºåŒæ­¥æ“ä½œçš„é”å­—æ®µã€‚ä½ ä¸éœ€è¦æ¯”è¾ƒæ´¾ç”Ÿå­—æ®µï¼ˆå¯ä»¥ä»ã€Œé‡è¦å­—æ®µã€è®¡ç®—ï¼‰ï¼Œä½†æ˜¯è¿™æ ·åšå¯èƒ½ä¼šæé«˜ equals æ–¹æ³•çš„æ€§èƒ½ã€‚



**å½“ä½ è¦†ç›– equals æ—¶ï¼Œä¹Ÿè¦†ç›– hashCodeã€‚**

IDE ä¹Ÿæœ‰ç”Ÿæˆ equals å’Œ hashCode æ–¹æ³•çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”Ÿæˆçš„æºä»£ç æ¯”ä½¿ç”¨ AutoValue çš„ä»£ç æ›´å†—é•¿ï¼Œå¯è¯»æ€§æ›´å·®ï¼Œä¸ä¼šè‡ªåŠ¨è·Ÿè¸ªç±»ä¸­çš„å˜åŒ–ï¼Œå› æ­¤éœ€è¦è¿›è¡Œæµ‹è¯•ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œè®© IDE ç”Ÿæˆ equalsï¼ˆå’Œ hashCodeï¼‰æ–¹æ³•é€šå¸¸æ¯”æ‰‹åŠ¨å®ç°æ›´å¯å–ï¼Œå› ä¸º IDE ä¸ä¼šå‡ºç°ç²—å¿ƒçš„é”™è¯¯ï¼Œè€Œäººä¼šã€‚

>IDEAè‡ªåŠ¨ç”Ÿæˆequalæ–¹æ³•ï¼š
>
>- æ–¹æ³•1. è¾“å…¥ equals æˆ– code åæŒ‰å›è½¦ï¼Œæœ€ç›´æ¥çš„æ–¹æ³•ï¼›
>- æ–¹æ³•2. åœ¨ä»£ç åŒºåŸŸæŒ‰ alt + enter æˆ– å³é”® Generateé€‰é¡¹ï¼Œæ˜¯é€šå¸¸æ–¹æ³•ï¼›



æ€»ä¹‹ï¼Œé™¤éå¿…é¡»ï¼Œå¦åˆ™ä¸è¦è¦†ç›– equals æ–¹æ³•ï¼šåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä» Object ç»§æ‰¿è€Œæ¥çš„å®ç°æ­£æ˜¯ä½ æƒ³è¦çš„ã€‚å¦‚æœä½ ç¡®å®è¦†ç›–äº† equalsï¼Œé‚£ä¹ˆä¸€å®šè¦æ¯”è¾ƒç±»çš„æ‰€æœ‰é‡è¦å­—æ®µï¼Œå¹¶ä»¥ä¿ç•™ equals çº¦å®šçš„æ‰€æœ‰ 5 é¡¹è§„å®šçš„æ–¹å¼è¿›è¡Œæ¯”è¾ƒã€‚

---

***Reference***:

1. [Item 10: Obey the general contract when overriding equalsï¼ˆè¦†ç›– equals æ–¹æ³•æ—¶åº”éµå®ˆçš„çº¦å®šï¼‰](https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/blob/dev/Chapter-3/Chapter-3-Item-10-Obey-the-general-contract-when-overriding-equals.md)

