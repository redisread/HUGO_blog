---
title: 2-å½“æ„é€ å‡½æ•°æœ‰å¤šä¸ªå‚æ•°æ—¶ï¼Œè€ƒè™‘æ”¹ç”¨æ„å»ºå™¨
date: 2021-10-16T18:35:36+08:00
description: Consider a builder when faced with many constructor parametersã€‚ä½¿ç”¨å»ºé€ è€…æ¨¡å¼åˆ›å»ºå…è®¸éƒ¨åˆ†å‚æ•°æ²¡æœ‰çš„ç±»ã€‚
draft: true
hideToc: false
enableToc: true
enableTocContent: false
tocPosition: outer
author: Victor
authorEmoji: ğŸ‘»
image: https://cos.jiahongw.com/uPic/image-20211016174809419.png
plantuml: true
libraries:
- katex
- mathjax
tags:
- EffectiveJava
series:
- EffectiveJava
categories:
-
---



<!--ç¬¬äºŒç« ï¼šåˆ›å»ºå’Œé”€æ¯å¯¹è±¡-->

### å¤šå‚æ•°æ„é€ å‡½æ•°çš„é—®é¢˜

é™æ€å·¥å‚å’Œæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ªå±€é™ï¼šå®ƒä»¬ä¸èƒ½å¯¹å¤§é‡å¯é€‰å‚æ•°åšå¾ˆå¥½çš„æ‰©å±•ã€‚ä»¥ä¸€ä¸ªç±»ä¸ºä¾‹ï¼Œå®ƒè¡¨ç¤ºåŒ…è£…é£Ÿå“ä¸Šçš„è¥å…»æ ‡ç­¾ã€‚è¿™äº›æ ‡ç­¾ä¸Šæœ‰ä¸€äº›å­—æ®µæ˜¯å¿…éœ€çš„ï¼Œå¦‚ï¼šå‡€å«é‡ã€æ¯›é‡å’Œæ¯å•ä½ä»½é‡çš„å¡è·¯é‡Œï¼Œå¦æœ‰è¶…è¿‡ 20 ä¸ªå¯é€‰çš„å­—æ®µï¼Œå¦‚ï¼šæ€»è„‚è‚ªã€é¥±å’Œè„‚è‚ªã€åå¼è„‚è‚ªã€èƒ†å›ºé†‡ã€é’ ç­‰ç­‰ã€‚å¤§å¤šæ•°äº§å“åªæœ‰è¿™äº›å¯é€‰å­—æ®µä¸­çš„å°‘æ•°ï¼Œä¸”å…·æœ‰éé›¶å€¼ã€‚

åº”è¯¥ä¸ºè¿™æ ·çš„ç±»ç¼–å†™ä»€ä¹ˆç§ç±»çš„æ„é€ å‡½æ•°æˆ–é™æ€å·¥å‚å‘¢ï¼Ÿä¼ ç»Ÿçš„æ–¹å¼æ˜¯ä½¿ç”¨å¯ä¼¸ç¼©æ„é€ å‡½æ•°ï¼Œåœ¨è¿™ç§æ¨¡å¼ä¸­ï¼Œåªå‘æ„é€ å‡½æ•°æä¾›å¿…éœ€çš„å‚æ•°ã€‚å³ï¼Œå‘ç¬¬ä¸€ä¸ªæ„é€ å‡½æ•°æä¾›å•ä¸ªå¯é€‰å‚æ•°ï¼Œå‘ç¬¬äºŒä¸ªæ„é€ å‡½æ•°æä¾›ä¸¤ä¸ªå¯é€‰å‚æ•°ï¼Œä»¥æ­¤ç±»æ¨ï¼Œæœ€åä¸€ä¸ªæ„é€ å‡½æ•°æ˜¯å…·æœ‰æ‰€æœ‰å¯é€‰å‚æ•°çš„ã€‚è¿™æ˜¯å®ƒåœ¨å®é™…åº”ç”¨ä¸­çš„æ ·å­ã€‚

```java
// Telescoping constructor pattern - does not scale well!
public class NutritionFacts {
    private final int servingSize; // (mL) required
    private final int servings; // (per container) required
    private final int calories; // (per serving) optional
    private final int fat; // (g/serving) optional
    private final int sodium; // (mg/serving) optional
    private final int carbohydrate; // (g/serving) optional

    public NutritionFacts(int servingSize, int servings) {
        this(servingSize, servings, 0);
    }

    public NutritionFacts(int servingSize, int servings, int calories) {
        this(servingSize, servings, calories, 0);
    }

    public NutritionFacts(int servingSize, int servings, int calories, int fat) {
        this(servingSize, servings, calories, fat, 0);
    }

    public NutritionFacts(int servingSize, int servings, int calories, int fat, int sodium) {
        this(servingSize, servings, calories, fat, sodium, 0);
    }

    public NutritionFacts(int servingSize, int servings, int calories, int fat, int sodium, int carbohydrate) {
        this.servingSize = servingSize;
        this.servings = servings;
        this.calories = calories;
        this.fat = fat;
        this.sodium = sodium;
        this.carbohydrate = carbohydrate;
    }
}
```

> æ‹“å±•ï¼Œåœ¨Java8ä¹‹åï¼Œå¯¹äºé‚£äº›å¯æœ‰å¯æ— çš„æˆå‘˜å˜é‡æœ€å¥½ä½¿ç”¨Optionalè¿›è¡Œé™åˆ¶ã€‚

å½“ä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼Œè¿™æ ·è¿›è¡Œè°ƒç”¨ï¼š

```java
NutritionFacts cocaCola =new NutritionFacts(240, 8, 100, 0, 35, 27);
```

é€šå¸¸ï¼Œ**è¿™ä¸ªæ„é€ å‡½æ•°åŒ…å«è®¸å¤šé¢å¤–çš„å‚æ•°ï¼Œä½†æ˜¯ä½ å¿…é¡»ä¸ºå®ƒä»¬ä¼ é€’ä¸€ä¸ªå€¼**ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬ä¸º fat ä¼ é€’äº†ä¸€ä¸ªå€¼ 0ï¼ˆå› ä¸ºæˆ‘ä»¬å¿…é¡»å¡«å…¥ä¸€ä¸ªæ•°ï¼Œè¿™æ ·æ‰èƒ½åŒ¹é…å‡½æ•°ï¼‰ã€‚åªæœ‰å…­ä¸ªå‚æ•°æ—¶ï¼Œè¿™å¯èƒ½çœ‹èµ·æ¥ä¸é‚£ä¹ˆç³Ÿï¼Œä½†éšç€å‚æ•°çš„å¢åŠ ï¼Œå®ƒå¾ˆå¿«å°±ä¼šå¤±æ§ã€‚

> ç®€å•åœ°è¯´ï¼Œ**å¯ä¼¸ç¼©æ„é€ å‡½æ•°æ¨¡å¼å¯ä»¥å·¥ä½œï¼Œä½†æ˜¯å½“æœ‰å¾ˆå¤šå‚æ•°æ—¶ï¼Œç¼–å†™å®¢æˆ·ç«¯ä»£ç æ˜¯å¾ˆå›°éš¾çš„ï¼Œè€Œä¸”è¯»èµ·æ¥æ›´å›°éš¾ã€‚** è¯»è€…æƒ³çŸ¥é“æ‰€æœ‰è¿™äº›å€¼æ˜¯ä»€ä¹ˆæ„æ€ï¼Œå¿…é¡»ä»”ç»†æ¸…ç‚¹å‚æ•°ã€‚ç›¸åŒç±»å‹å‚æ•°çš„é•¿åºåˆ—ä¼šå¯¼è‡´ç»†å¾®çš„é”™è¯¯ã€‚å¦‚æœå®¢æˆ·ç«¯ä¸å°å¿ƒå€’è½¬äº†ä¸¤ä¸ªè¿™æ ·çš„å‚æ•°ï¼Œç¼–è¯‘å™¨ä¸ä¼šæŠ¥é”™ï¼Œä½†æ˜¯ç¨‹åºä¼šåœ¨è¿è¡Œæ—¶å‡ºé”™

### è§£å†³åŠæ³•1-ä½¿ç”¨JavaBeanæ¨¡å¼

è¿™ç§æ¨¡å¼æ˜¯è¿™æ ·è¿ä½œçš„ï¼š**å…ˆé€šè¿‡ä¸€ä¸ªæ— å‚æ„é€ å‡½æ•°åˆ›å»ºå¯¹è±¡ï¼Œç„¶åè°ƒç”¨å¯¹è±¡çš„setteræ–¹æ³•è®¾ç½®éœ€è¦è®¾ç½®çš„å€¼**ã€‚

> JavaBeanæ˜¯ä¸€ç§ç¬¦åˆå‘½åè§„èŒƒçš„`class`ï¼Œå®ƒé€šè¿‡`getter`å’Œ`setter`æ¥å®šä¹‰å±æ€§

ä¾‹å¦‚å®šä¹‰ä¸€ä¸ªJavaBeanæ¨¡å¼çš„ç±»ï¼š

```java
// JavaBeans Pattern - allows inconsistency, mandates mutability
public class NutritionFacts {
    // Parameters initialized to default values (if any)
    private int servingSize = -1; // Required; no default value
    private int servings = -1; // Required; no default value
    private int calories = 0;
    private int fat = 0;
    private int sodium = 0;
    private int carbohydrate = 0;
    public NutritionFacts() { }
    // Setters
    public void setServingSize(int val) { servingSize = val; }
    public void setServings(int val) { servings = val; }
    public void setCalories(int val) { calories = val; }
    public void setFat(int val) { fat = val; }
    public void setSodium(int val) { sodium = val; }
    public void setCarbohydrate(int val) { carbohydrate = val; }
}
```

åœ¨å®é™…çš„ä½¿ç”¨æ˜¯è¿™æ ·çš„ï¼š

```java
NutritionFacts cocaCola = new NutritionFacts();
cocaCola.setServingSize(240);
cocaCola.setServings(8);
cocaCola.setCalories(100);
cocaCola.setSodium(35);
cocaCola.setCarbohydrate(27);
```

è™½ç„¶JavaBeanæ¨¡å¼å¯ä»¥å¾ˆæ–¹ä¾¿çš„è®©æˆ‘ä»¬è‡ªç”±çš„è®¾ç½®æˆ‘ä»¬éœ€è¦è®¾ç½®çš„å€¼ï¼Œä½†æ˜¯**å› ä¸ºæ„å»ºæ˜¯åœ¨å¤šä¸ªè°ƒç”¨ä¹‹é—´è¿›è¡Œçš„ï¼Œæ‰€ä»¥ JavaBean å¯èƒ½åœ¨æ„å»ºçš„è¿‡ç¨‹ä¸­å¤„äºä¸ä¸€è‡´çš„çŠ¶æ€ã€‚**ï¼ˆå¹¶å‘æƒ…å†µï¼‰

è¯¥ç±»ä¸èƒ½ä»…é€šè¿‡æ£€æŸ¥æ„é€ å‡½æ•°å‚æ•°çš„æœ‰æ•ˆæ€§æ¥å¼ºåˆ¶ä¸€è‡´æ€§ã€‚åœ¨ä¸ä¸€è‡´çš„çŠ¶æ€ä¸‹å°è¯•ä½¿ç”¨å¯¹è±¡å¯èƒ½ä¼šå¯¼è‡´é”™è¯¯çš„å‘ç”Ÿï¼Œè€ŒåŒ…å«è¿™äº›é”™è¯¯çš„ä»£ç å¾ˆéš¾è°ƒè¯•ã€‚

å¦å¤–ä¸€ä¸ªç›¸å…³çš„ç¼ºç‚¹æ˜¯ï¼ŒJavaBean æ¨¡å¼**æ’é™¤äº†ä½¿ç±»ä¸å¯å˜çš„å¯èƒ½æ€§**ï¼Œå› ä¸ºSetteræ–¹æ³•å·²ç»æš´éœ²å†…éƒ¨æ•°æ®ä¿®æ”¹çš„æ–¹æ³•ã€‚é™¤éç¨‹åºå‘˜è‡ªå·±æ¥ç¡®ä¿çº¿ç¨‹å®‰å…¨ã€‚

### è§£å†³åŠæ³•2-ä½¿ç”¨å»ºé€ è€…æ¨¡å¼

> å»ºé€ è€…æ¨¡å¼ç»“åˆäº†å¯ä¼¸ç¼©æ„é€ å‡½æ•°æ¨¡å¼çš„å®‰å…¨æ€§å’Œ JavaBean æ¨¡å¼çš„å¯è¯»æ€§ã€‚

å®¢æˆ·ç«¯ä¸ç›´æ¥ç”Ÿæˆæ‰€éœ€çš„å¯¹è±¡ï¼Œè€Œæ˜¯**ä½¿ç”¨æ‰€æœ‰å¿…éœ€çš„å‚æ•°è°ƒç”¨æ„é€ å‡½æ•°ï¼ˆæˆ–é™æ€å·¥å‚ï¼‰**ï¼Œå¹¶è·å¾—ä¸€ä¸ª builder å¯¹è±¡ã€‚ç„¶åï¼Œå®¢æˆ·ç«¯åœ¨æ„å»ºå™¨å¯¹è±¡ä¸Šè°ƒç”¨åƒ setter è¿™æ ·çš„æ–¹æ³•æ¥è®¾ç½®æ¯ä¸ªæ„Ÿå…´è¶£çš„å¯é€‰å‚æ•°ã€‚æœ€åï¼Œå®¢æˆ·ç«¯è°ƒç”¨ä¸€ä¸ªæ— å‚æ•°çš„æ„å»ºæ–¹æ³•æ¥ç”Ÿæˆå¯¹è±¡ï¼Œè¿™é€šå¸¸æ˜¯ä¸å¯å˜çš„ã€‚æ„å»ºå™¨é€šå¸¸æ˜¯å®ƒæ„å»ºçš„ç±»çš„**é™æ€æˆå‘˜ç±»**ã€‚ä¸‹é¢æ˜¯å®ƒåœ¨å®é™…åº”ç”¨ä¸­çš„æ ·å­ï¼š

```java
// Builder Pattern
public class NutritionFacts {
    private final int servingSize;
    private final int servings;
    private final int calories;
    private final int fat;
    private final int sodium;
    private final int carbohydrate;

    public static class Builder {
        // Required parameters
        private final int servingSize;
        private final int servings;
        // Optional parameters - initialized to default values
        private int calories = 0;
        private int fat = 0;
        private int sodium = 0;
        private int carbohydrate = 0;

        public Builder(int servingSize, int servings) {
            this.servingSize = servingSize;
            this.servings = servings;
        }

        public Builder calories(int val) {
            calories = val;
            return this;
        }

        public Builder fat(int val) {
            fat = val;
            return this;
        }

        public Builder sodium(int val) {
            sodium = val;
            return this;
        }

        public Builder carbohydrate(int val) {
            carbohydrate = val;
            return this;
        }

        public NutritionFacts build() {
            return new NutritionFacts(this);
        }
    }

    private NutritionFacts(Builder builder) {
        servingSize = builder.servingSize;
        servings = builder.servings;
        calories = builder.calories;
        fat = builder.fat;
        sodium = builder.sodium;
        carbohydrate = builder.carbohydrate;
    }
}
```

> è¿™é‡Œä¸ºäº†ç®€æ´ï¼Œçœç•¥äº†æœ‰æ•ˆæ€§æ£€æŸ¥ã€‚

ä½¿ç”¨ï¼š

```java
NutritionFacts cocaCola = new NutritionFacts.Builder(240, 8)
.calories(100).sodium(35).carbohydrate(27).build();
```

> NutritionFacts ç±»æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºæ„é€ å¯¹è±¡å¹¶æ²¡æœ‰è°ƒç”¨setteræ–¹æ³•ï¼Œæ‰€æœ‰å‚æ•°é»˜è®¤å€¼éƒ½åœ¨ä¸€ä¸ªä½ç½®ã€‚æ„å»ºå™¨çš„ setter æ–¹æ³•è¿”å›æ„å»ºå™¨æœ¬èº«ï¼Œè¿™æ ·å°±å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæµç•…çš„ APIã€‚

å»ºé€ è€…æ¨¡å¼éå¸¸é€‚åˆäºç±»å±‚æ¬¡ç»“æ„ã€‚ä½¿ç”¨æ„å»ºå™¨çš„å¹¶è¡Œå±‚æ¬¡ç»“æ„ï¼Œæ¯ä¸ªæ„å»ºå™¨éƒ½åµŒå¥—åœ¨ç›¸åº”çš„ç±»ä¸­ã€‚æŠ½è±¡ç±»æœ‰æŠ½è±¡ç±»æ„å»ºå™¨ï¼›å…·ä½“ç±»æœ‰å…·ä½“ç±»æ„å»ºå™¨ã€‚

![å»ºé€ è€…æ¨¡å¼-ç»§æ‰¿](https://cos.jiahongw.com/uPic/image-20211018201949975.png)

ç»§æ‰¿çš„è¯éœ€è¦åŒç»§æ‰¿ï¼Œå­ç±»å’Œå­ç±»æ„é€ å™¨å¯¹åº”ç»§æ‰¿çˆ¶ç±»çš„ã€‚

### å»ºé€ è€…æ¨¡å¼çš„ç¼ºç‚¹

1. ä¸ºäº†åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œä½ å¿…é¡»é¦–å…ˆåˆ›å»ºå®ƒçš„æ„å»ºå™¨ã€‚
2. è™½ç„¶åœ¨å®é™…åº”ç”¨ä¸­åˆ›å»ºè¿™ä¸ªæ„å»ºå™¨çš„æˆæœ¬å¯èƒ½å¹¶ä¸æ˜¾è‘—ï¼Œä½†åœ¨ä»¥æ€§èƒ½ä¸ºå…³é”®çš„åœºæ™¯ä¸‹ï¼Œè¿™å¯èƒ½ä¼šæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚
3. å»ºé€ è€…æ¨¡å¼æ¯”å¯ä¼¸ç¼©æ„é€ å‡½æ•°æ¨¡å¼æ›´å†—é•¿ã€‚å› æ­¤åªæœ‰åœ¨æœ‰è¶³å¤Ÿå¤šçš„å‚æ•°æ—¶æ‰å€¼å¾—ä½¿ç”¨ï¼Œæ¯”å¦‚æœ‰ 4 ä¸ªæˆ–æ›´å¤šå‚æ•°æ—¶ï¼Œæ‰åº”è¯¥ä½¿ç”¨å®ƒã€‚

> å¦‚æœä½ ä»¥æ„é€ å‡½æ•°æˆ–é™æ€å·¥å‚å¼€å§‹ï¼Œç›´è‡³ç±»æ‰©å±•åˆ°å‚æ•°æ•°é‡æ— æ³•æ§åˆ¶çš„ç¨‹åº¦æ—¶ï¼Œä¹Ÿä¼šåˆ‡æ¢åˆ°æ„å»ºå™¨ï¼Œä½†æ˜¯è¿‡æ—¶çš„æ„é€ å‡½æ•°æˆ–é™æ€å·¥å‚å°†å¾ˆéš¾å¤„ç†ã€‚å› æ­¤ï¼Œæœ€å¥½ä¸€å¼€å§‹å°±ä»æ„å»ºå™¨å¼€å§‹ã€‚

### æ€»ç»“

æ€»ä¹‹ï¼Œåœ¨è®¾è®¡æ„é€ å‡½æ•°æˆ–é™æ€å·¥å‚çš„ç±»æ—¶ï¼Œå»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ï¼Œç‰¹åˆ«æ˜¯å½“è®¸å¤šå‚æ•°æ˜¯å¯é€‰çš„æˆ–å…·æœ‰ç›¸åŒç±»å‹æ—¶ã€‚ä¸å¯ä¼¸ç¼©æ„é€ å‡½æ•°ç›¸æ¯”ï¼Œä½¿ç”¨æ„å»ºå™¨å®¢æˆ·ç«¯ä»£ç æ›´å®¹æ˜“è¯»å†™ï¼Œè€Œä¸”æ„å»ºå™¨æ¯” JavaBean æ›´å®‰å…¨ã€‚

---

***Reference***ï¼š

1. [ç§’æ‡‚è®¾è®¡æ¨¡å¼ä¹‹å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder patternï¼‰ - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/58093669)
2. [Effective-Java-3rd-edition-Chinese-English-bilingual/Chapter-2-Item-2-Consider-a-builder-when-faced-with-many-constructor-parameters.md at dev Â· clxering/Effective-Java-3rd-edition-Chinese-English-bilingual](https://github.com/clxering/Effective-Java-3rd-edition-Chinese-English-bilingual/blob/dev/Chapter-2/Chapter-2-Item-2-Consider-a-builder-when-faced-with-many-constructor-parameters.md)
