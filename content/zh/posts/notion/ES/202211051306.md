---
title: ES APIä½¿ç”¨ç¬”è®°
date: '2022-11-05T13:06:00.000Z'
description: åŒ…æ‹¬æŸ¥è¯¢å‘¢ã€å†™å…¥ã€èšåˆåˆ†æç­‰æ“ä½œæŒ‡å—
draft: false
hideToc: false
enableToc: true
tocPosition: outer
author: Victor
authorEmoji: ğŸ‘»
image: https://cos.jiahongw.com/uPic/pluginIcon.png
plantuml: true
libraries:
- katex
- mathjax
- chart
- flowchartjs
- mermaid
tags:
- ES
- API
series: ''
categories:
- ES

---




## ES HTTP API


ä½¿ç”¨åŸºæœ¬æ¨¡æ¿ï¼š


![](https://raw.githubusercontent.com/redisread/Image/master/notionimg/6e/b9/6eb96cf0e68bde3131bc5ff932a8bdda.png)


### åˆ›å»ºç´¢å¼•


> å‚è€ƒï¼šCreate index API


åˆ›å»ºä¸€ä¸ªç´¢å¼•çš„æ–¹æ³•å¾ˆç®€å•ï¼Œåœ¨Kibanaä¸­è¿è¡Œä¸‹è¡Œè¯·æ±‚å³å¯åˆ›å»ºä¸€ä¸ªåä¸ºâ€œindex1â€çš„ç´¢å¼•


```shell
PUT /index1
```


å¯ä»¥å¢åŠ ç›¸å…³è®¾ç½®å’Œæ˜ å°„ï¼š


```json
PUT /test{  "settings": {    // ç´¢å¼•åˆ†ç‰‡æ•°é‡    "number_of_shards": 1  },  "mappings": {    "properties": {      "field1": { "type": "text" }    }  }}
```


**åˆ›å»ºç´¢å¼•å¹¶ä¸”æ·»åŠ åˆ«å**


æ·»åŠ aliasesï¼š


```json
PUT /test{  "aliases": {    "alias_1": {},    "alias_2": {      "filter": {        "term": { "user.id": "kimchy" }      },      "routing": "shard-1"    }  }}
```


ESä¸­ç´¢å¼•æ”¯æŒå…³é—­å’Œæ‰“å¼€æ“ä½œï¼Œä¸€ä¸ªå…³é—­çš„ç´¢å¼•é™¤äº†ç»´æŠ¤å…ƒæ•°æ®çš„åŸºæœ¬æ¶ˆè€—å¤–ï¼Œå‡ ä¹æ²¡æœ‰ä»»ä½•å…¶ä»–å¼€é”€ï¼Œåœ¨å…³é—­çŠ¶æ€ä¸‹çš„ç´¢å¼•ç¦æ­¢è¿›è¡ŒIOæ“ä½œï¼Œå†æ¬¡æ‰“å¼€åå¯æ¢å¤æ­£å¸¸çŠ¶æ€ã€‚


æ·»åŠ åˆ«åï¼š


```text
{
    "actions": [
        {"add": {"index": "grocery_inventory_poi_stock_trans_143239919098404_202202",
         "alias": "grocery_inventory_poi_stock_trans_143239919098404"}
         },
         {
           "add": {"index": "grocery_inventory_shelf_stock_trans_143239919098404_202202",
         "alias": "grocery_inventory_shelf_stock_trans_143239919098404"}
         }
    ]
}
```


åˆ é™¤åˆ«åï¼š


```text
{
    "actions": [
        {"remove": {"index": "grocery_inventory_poi_stock_trans_143239919098404_202202",
         "alias": "grocery_inventory_poi_stock_trans_143239919098404"}
         },
         {
           "remove  ": {"index": "grocery_inventory_shelf_stock_trans_143239919098404_202202",
         "alias": "grocery_inventory_shelf_stock_trans_143239919098404"}
         }
    ]
}
```


### å…³é—­ç´¢å¼•


è¯­æ³•ï¼š`POST /<index>/_close`


```shell
POST /index1/_close
```


è¿”å›ç»“æœï¼š


```json
{  "acknowledged": true,  "shards_acknowledged": true,  "indices": {    "my-index-000001": {      "closed": true    }  }}
```


æ”¯æŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œå…³é—­ï¼š


```shell
POST /index*/_close
```


æˆ–è€…ç›´æ¥æŒ‡å®šå…³é—­å¤šä¸ªç´¢å¼•(ç´¢å¼•ä¹‹é—´ä½¿ç”¨ `,` åˆ†éš”)ï¼š


```shell
POST /index1,index2/_close
```


> ESç´¢å¼•å¤„äºopençŠ¶æ€ï¼Œå°±ä¼šå ç”¨å†…å­˜+ç£ç›˜ï¼› å¦‚æœå°†ç´¢å¼•closeï¼Œåªä¼šå ç”¨ç£ç›˜ï¼Œä¸ä¼šåŠ è½½åˆ°å†…å­˜ï¼Œå½“ç´¢å¼•æ¯”è¾ƒå¤šçš„æ—¶å€™å½±å“æŸ¥è¯¢é€Ÿåº¦ã€‚


ä¿®æ”¹ç´¢å¼•è®¾ç½®ï¼š


```text
PUT localhost:9200/teacher/_settings
{
    "number_of_replicas": 3
}
```


### æ‰“å¼€ç´¢å¼•


è¯­æ³•ï¼š`POST /<target>/_open`


```shell
POST /index1/_open
```


è¿”å›ç»“æœï¼š


```json
{  "acknowledged" : true,  "shards_acknowledged" : true}
```


æ”¯æŒä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼è¿›è¡Œæ‰¹é‡çš„æ‰“å¼€ç´¢å¼•ï¼š


```shell
POST /index*/_open
```


æˆ–è€…ç›´æ¥æŒ‡å®šå…³é—­å¤šä¸ªç´¢å¼•(ç´¢å¼•ä¹‹é—´ä½¿ç”¨ `,` åˆ†éš”)ï¼š


```shell
POST /index1,index2/_open
```


> // å¯ä»¥ä½¿ç”¨_allæ‰“å¼€æˆ–å…³é—­å…¨éƒ¨ç´¢å¼•, ä¹Ÿå¯ä½¿ç”¨é€šé…ç¬¦(*)é…åˆæ“ä½œ


	```shell
	POST _all/_closePOST _all/_open
	```


Postè¯·æ±‚å¯ä»¥æ·»åŠ ç›¸å…³çš„è¯·æ±‚å‚æ•°ï¼š


```json
{    //æ˜¯å¦åœ¨ä»»ä½•æŒ‡å®šçš„ç´¢å¼•ä¸å¯ç”¨æ—¶å¿½ç•¥ï¼Œè¿™åŒ…æ‹¬ä¸å­˜åœ¨çš„ç´¢å¼•æˆ–å…³é—­çš„ç´¢å¼•ã€‚    "ignore_unavailable": true,    // å¦‚æœé€šé…ç¬¦ç´¢å¼•è¡¨è¾¾å¼å¯¼è‡´æ²¡æœ‰å…·ä½“ç´¢å¼•ï¼Œåˆ™æ§åˆ¶æ˜¯å¦å¤±è´¥.    "allow_no_indices": true,}
```


### åˆ é™¤ç´¢å¼•


åˆ é™¤ç´¢å¼•ï¼šé€šè¿‡ä¸‹æ–¹æ¥å£å¯ä»¥åˆ é™¤ä¸€ä¸ªç´¢å¼•ï¼Œå¦‚æœåˆ é™¤æˆåŠŸï¼Œå°†è¿”å›acknowledge:true


è¯­æ³•ï¼š`DELETE /<index>`


```shell
DELETE /index3?pretty
```


### å±•ç¤ºç´¢å¼•


åˆ—å‡ºæ‰€æœ‰çš„ç´¢å¼•ï¼š


```text
GET _cat/indices?v
GET localhost:9200/_cat/indices?v
```


æ¨¡ç³ŠæŸ¥è¯¢ç´¢å¼•åï¼ŒæŸ¥æ‰¾åŒ…å«å•è¯dataçš„ç´¢å¼•åï¼š


```text
GET _cat/indices/*data*?v
```


> ä½¿ç”¨prettyå…³é”®å­—è®©è¿”å›çš„ç»“æœæ ¼å¼åŒ–ï¼ˆæ›´åŠ ç¾è§‚ï¼‰ï¼š


	```text
	GET _cat/indices/*data*?v&pretty
	```


	ä½†æ˜¯æœ€å¥½ä»…ç”¨äºè°ƒè¯•


æŸ¥è¯¢ç´¢å¼•é…ç½®ï¼š


```text
GET /{index}/_settings
```


### è¯»å†™ç´¢å¼•


### åˆ›å»ºæ–‡æ¡£


ä½¿ç”¨è¯­æ³•ï¼š `PUT /{index}/_doc/{id}`


ä¾‹å­ï¼š


```text
PUT localhost:9200/student/_doc/1
{
    "name" : "victor"
}
```


è¿”å›ç»“æœï¼š


```json
{    "_index": "student",    "_type": "_doc",    "_id": "1",    "_version": 1,    "result": "created",    "_shards": {        "total": 2,        "successful": 1,        "failed": 0    },    "_seq_no": 0,    "_primary_term": 1}
```


> å‡å¦‚ç´¢å¼•studentä¹‹å‰æ²¡æœ‰åˆ›å»ºè¿‡ï¼Œæ‰§è¡Œè¿™æ¡è¯­å¥ä¹‹åä¹Ÿä¼šè‡ªåŠ¨åˆ›å»ºè¿™ä¸ªç´¢å¼•ï¼Œç›¸å…³çš„å‚æ•°éƒ½æ˜¯é»˜è®¤çš„å‚æ•°ã€‚å¦‚æœè¿˜æ²¡æœ‰åˆ›å»ºä¸€ä¸ªåŠ¨æ€ç±»å‹æ˜ å°„ï¼Œä¹Ÿä¼šè‡ªåŠ¨ä¸ºç‰¹å®šç±»å‹åˆ›å»ºä¸€ä¸ªåŠ¨æ€ç±»å‹æ˜ å°„ã€‚ï¼ˆä½¿ç”¨åŠ¨æ€æ˜ å°„å¾ˆæ¶ˆè€—æ€§èƒ½ï¼‰


	é€šè¿‡è®¾ç½®é…ç½®æ–‡ä»¶ä¸­çš„`action.auto_create_index` ä¸º `false` æˆ–è€…é€šè¿‡è®¾ç½® setting çš„ `index.mapper.dynamic` ä¸º `false`ã€‚


è‡ªåŠ¨å¡«å……idï¼š


```text
POST localhost:9200/student/_doc
{
    "name" : "hong"
}
```


ç»“æœè‡ªåŠ¨ç”Ÿæˆéšæœºçš„IDï¼š


```json
{    "_index": "student",    "_type": "_doc",    "_id": "obtj3nwBLeSa-n0f2397",    "_version": 1,    "result": "created",    "_shards": {        "total": 2,        "successful": 1,        "failed": 0    },    "_seq_no": 0,    "_primary_term": 2}
```


### æ›´æ–°æ–‡æ¡£


ä½¿ç”¨è¯­æ³•ï¼š`PUT /{index}/{type}/{id}`


```text
sourceé‡Œé¢çš„å­—æ®µæ˜ å°„
```


> å› ä¸ºESåœ¨Luceneåˆ†æ®µä¸­å­˜å‚¨æ•°æ®ï¼Œè€Œåˆ†æ®µä¸€æ—¦åˆ›å»ºå°±ä¸ä¼šä¿®æ”¹ï¼Œå› æ­¤æ›´æ–°æ–‡æ¡£æ„å‘³ç€ä»åŸæ¥çš„æ–‡æ¡£ç´¢å¼•æ•°æ®ï¼Œç„¶åå°†ä¿®æ”¹æ”¾å…¥å³å°†ç´¢å¼•çš„æ–°æ–‡æ¡£ä¸­ï¼Œç„¶ååˆ é™¤æ—§çš„ç´¢å¼•(æ ‡è®°ä¸€ä¸‹,åå°å¼‚æ­¥åˆ é™¤)ã€‚


### æŸ¥è¯¢å¹¶æ›´æ–°æ–‡æ¡£


```text
POST index/type/_update_by_query
{
  "script": {
    "source": "ctx._source['type']='å…”å­'"
  },
  "query": {
    "term": {
      "petRaceId": {
        "value": "3"
      }
    }
  }
}
```


ä¸Šé¢çš„ä¾‹å­è¡¨ç¤ºå°†å­—æ®µpetRaceIdçš„value=3çš„æ–‡æ¡£çš„typeå€¼æ”¹ä¸ºï¼šå…”å­ã€‚


Java APIçš„ä½¿ç”¨ï¼š


```java
public void updateByQuery(Long routeId, String index, String type, QueryBuilder query,        String strScript) {        PorosRestHighLevelClient client = getEagleClient(routeId);        String endpoint = "/" + index + "/" + type + "/_update_by_query?conflicts=proceed";        if (query == null) {            return;        }        String queryString = "{"            + " \"script\": { "            + " \"source\": " + "\"" + strScript + "\""            + "},"            + " \"query\": " + query.toString()            + "}";        try {            lowLevelPerformRequest(client, queryString, endpoint, HttpPost.METHOD_NAME);        } catch (Exception e) {            LOGGER.error("updateByQuery è¯·æ±‚å¤±è´¥", e);        } }
```


UpdateByQueryRequest APIåœ¨ES6ä»¥ä¸Šçš„ç‰ˆæœ¬é€‚ç”¨ã€‚


> scriptç¼–å†™æŒ‡å—ï¼š

	- ä¿®æ”¹å¤šå€¼ï¼š

		```json
		 {  "script": {"source":"ctx._source['user_name']='LsiuLi';ctx._source['assignedto_id']='123';"},  "query": {"term": {"user_id": 60}}}
		```

	- å¢åŠ æ•°ç»„å…ƒç´ 

		http://localhost:9200/1909_user/user/15670260/_update


		```json
		{    "script": {    "lang": "painless",        "source":"ctx._source['field_mult_value_7917'].add(params.hobby)",        "params" : {            "hobby" : "c"        }    }}
		```

	- åˆ é™¤indexä¸­çš„field

		http://localhost:9200/1542_case/case/_update_by_query?wait_for_completion=false&conflicts=proceed


		```json
		{"script": {"source":"ctx._source.remove('user_field_email_5613')"}}
		```


`?conflicts=proceed` è¡¨ç¤ºä»€ä¹ˆæ„æ€ï¼Ÿ


### ä½¿ç”¨è„šæœ¬æ›´æ–°æ–‡æ¡£


é»˜è®¤çš„è„šæœ¬è¯­è¨€æ˜¯groovyï¼Œä½¿ç”¨`ctx._source`æ¥å¼•ç”¨`_source`ï¼Œä½¿ç”¨`ctx._source[å­—æ®µå]`æ¥å¼•ç”¨æŸä¸ªæŒ‡å®šçš„å­—æ®µã€‚


### é€šè¿‡ç‰ˆæœ¬å®ç°å¹¶å‘æ§åˆ¶


å¦‚æœåŒä¸€æ—¶åˆ»å¤šæ¬¡æ›´æ–°éƒ½åœ¨æ‰§è¡Œï¼Œå°±ä¼šæœ‰å¹¶å‘é—®é¢˜ã€‚


åŠ å…¥ä¸¤ä¸ªæ›´æ–°éƒ½æ›´æ–°åŒä¸€ç¯‡æ–‡æ¡£çš„å­—æ®µnameï¼Œåˆå§‹å€¼â€œLearn ElasticSearchâ€ï¼Œä¸‹é¢çš„è¿‡ç¨‹å±•ç¤ºäº†æ›´æ–°2å¿½ç•¥äº†æ›´æ–°1çš„æ“ä½œï¼Œç›´æ¥è¦†ç›–äº†æ›´æ–°1çš„æ“ä½œï¼Œæ›´æ–°1è¿”å›çš„è¿˜æ˜¯æœªæ›´æ–°çš„æ•°æ®


| æ›´æ–°1                              | æ›´æ–°2                              |
| -------------------------------- | -------------------------------- |
| æ›´æ–°name=â€œKnow ElasticSearchâ€      |                                  |
|                                  | æ›´æ–°name=â€œLearn ElasticSearchâ€     |
| æ›´æ–°1å®Œæˆ                            |                                  |
|                                  | æ›´æ–°2å®Œæˆ                            |
| è¿”å›ç»“æœ1ï¼šname=â€œLearn ElasticSearchâ€ | è¿”å›ç»“æœ2ï¼šname=â€œLearn ElasticSearchâ€ |


ESçš„å¹¶å‘æ§åˆ¶æ˜¯åœ¨æ¯ç¯‡æ–‡æ¡£è®¾ç½®äº†ä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæœ€åˆçš„æ–‡æ¡£ç‰ˆæœ¬æ˜¯1ï¼Œå½“æ›´æ–°æ“ä½œé‡æ–°ç´¢å¼•å®ƒçš„æ—¶å€™ï¼Œç‰ˆæœ¬å·å°±è®¾ç½®ä¸º2äº†ï¼Œå¦‚æœåœ¨æ­¤æ—¶åŒæ—¶æœ‰ä¸€ä¸ªæ›´æ–°æ“ä½œå°†ç‰ˆæœ¬è®¾ç½®ä¸º2ï¼Œé‚£ä¹ˆå°±ä¼šäº§ç”Ÿå†²çªï¼Œç›®å‰çš„æ›´æ–°ä¹Ÿä¼šå¤±è´¥ã€‚å¯ä»¥é‡è¯•è¿™ä¸ªæ›´æ–°æ“ä½œï¼Œå¦‚æœä¸åœ¨æœ‰å†²çªï¼Œé‚£ä¹ˆç‰ˆæœ¬å°±ä¼šè®¾ç½®ä¸º3ã€‚


| æ›´æ–°1                                        | æ›´æ–°2                                         |
| ------------------------------------------ | ------------------------------------------- |
| æ›´æ–°name=â€œKnow ElasticSearchâ€ï¼Œç‰ˆæœ¬å·ï¼š1ï¼Œå°†è®¾ç½®ç‰ˆæœ¬å·ä¸º2 |                                             |
|                                            | æ›´æ–°name=â€œLearn ElasticSearchâ€ï¼Œç‰ˆæœ¬å·ï¼š1ï¼Œå°†è®¾ç½®ç‰ˆæœ¬å·ä¸º2 |
|                                            | æ›´æ–°2å®Œæˆï¼Œç‰ˆæœ¬å·ï¼š2                                 |
| æ›´æ–°1æ‰§è¡Œï¼Œè®¾ç½®ç‰ˆæœ¬å·ä¸º2ï¼Œæ­¤æ—¶å†²çªï¼Œå¤±è´¥ï¼Œå› ä¸ºç‰ˆæœ¬å·2å·²ç»å­˜åœ¨           |                                             |
|                                            | è¿”å›ç»“æœ2ï¼šname=â€œLearn ElasticSearchâ€            |
| æ›´æ–°1ï¼Œè¿›è¡Œé‡è¯•ï¼Œç‰ˆæœ¬å·ï¼š2ï¼Œå°†è®¾ç½®ç‰ˆæœ¬å·ä¸º3                    |                                             |
| æ›´æ–°1å®Œæˆï¼Œç‰ˆæœ¬å·ï¼š3                                |                                             |
| è¿”å›ç»“æœ1ï¼šname=â€œKnow ElasticSearchâ€            |                                             |


è¿™ç§å¹¶å‘æ§åˆ¶ç§°ä¸ºä¹è§‚é”ï¼Œå› ä¸ºå®ƒå…è®¸å¹¶è¡Œçš„æ“ä½œå¹¶ä¸”å‡è®¾å†²çªæ˜¯å¾ˆå°‘çš„ï¼ŒçœŸçš„å‡ºç°å†²çªå°±æŠ›å‡ºé”™è¯¯ç„¶åè¿›è¡Œé‡è¯•ã€‚


è§£å†³å†²çªçš„æ–¹æ³•ï¼š

1. å†²çªå‘ç”Ÿæ—¶è‡ªåŠ¨é‡è¯•æ›´æ–°æ“ä½œ

	å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­è®¾ç½®é‡è¯•æ“ä½œï¼Œä¹Ÿå¯ä»¥åœ¨ESæ“ä½œæ›´æ–°çš„è¯­å¥ä¸­è®¾ç½®`retry_on_conflict`å‚æ•°(urlä¸­æ·»åŠ ?retry_on_conflict=3)ï¼Œè®©ESè¿›è¡Œè‡ªåŠ¨é‡è¯•ã€‚

2. ç´¢å¼•æ–‡æ¡£çš„æ—¶å€™ä½¿ç”¨ç‰ˆæœ¬å·

	è®¾ç½®httpè¯·æ±‚ä¸­çš„versionå‚æ•°ï¼Œå…¶å€¼åº”è¯¥æ˜¯ä½ æœŸæœ›æ–‡æ¡£è¦æ‹¥æœ‰çš„ç‰ˆæœ¬å·ã€‚ä¾‹å¦‚å¦‚æœä½ è®¤ä¸ºç°åœ¨çš„ç‰ˆæœ¬å·²ç»æ˜¯3äº†ï¼Œä¸€ä¸ªé‡æ–°ç´¢å¼•å¯ä»¥åœ¨httpæ·»åŠ ?version=3è¿™ä¸ªå‚æ•°é€‰é¡¹ã€‚


### æŸ¥è¯¢ç´¢å¼•


ä½¿ç”¨è¯­æ³•ï¼š`GET {index}/_search`


è¿”å›ç´¢å¼•çš„æ‰€æœ‰ä¿¡æ¯ï¼š


```json
{    "took": 49,    "timed_out": false,    "_shards": {        "total": 3,        "successful": 3,        "skipped": 0,        "failed": 0    },    "hits": {        "total": {            "value": 3,            "relation": "eq"        },        "max_score": 1.0,        "hits": [            {                "_index": "student",                "_type": "_doc",                "_id": "obtj3nwBLeSa-n0f2397",                "_score": 1.0,                "_source": {                    "name": "hong"                }            },            {                "_index": "student",                "_type": "_doc",                "_id": "ort13nwBLeSa-n0fTn_g",                "_score": 1.0,                "_routing": "hong",                "_source": {                    "name": "hong",                    "age": 22                }            },            {                "_index": "student",                "_type": "_doc",                "_id": "1",                "_score": 1.0,                "_source": {                    "name": "victor"                }            }        ]    }}
```


### æŸ¥è¯¢æ–‡æ¡£


æ¯ä¸ªæ–‡æ¡£éƒ½æœ‰ä¸€ä¸ª `_id`å”¯ä¸€æ ‡è¯†ï¼Œè¿™ä¸ªidå¯ä»¥åœ¨åˆ›å»ºæ–‡æ¡£çš„æ—¶å€™æ‰‹åŠ¨ä¼ å…¥æˆ–è€…ç”±esè‡ªå·±ç”Ÿæˆã€‚


> _id å­—æ®µåœ¨åšèšåˆã€æ’åºã€è„šæœ¬æ—¶åŠŸèƒ½å—é™ï¼Œå¦‚æœè¯´ä¸Šè¿°æ“ä½œéœ€è¦ç”¨åˆ° _id å­—æ®µï¼Œéœ€è¦æŠŠ _id çš„å€¼åœ¨ doc_values é‡Œä¹Ÿä¿å­˜ä¸€ä»½


### ç›¸å…³æŸ¥è¯¢æ–¹å¼


1 æ ¹æ® `get api` æŸ¥è¯¢


```text
GET {my_index}/_doc/{myid}
```


2 æ ¹æ® `ids query` æŸ¥è¯¢


```text
GET {my_index}/_search
{
    "query":
    {
        "ids":
        {
            "values":[1,2,3]
        }
    }
}
```


3 æ ¹æ® `term` , `terms` , `match` æŸ¥è¯¢


```text
# term
GET {my_index}/_search
{
  "query": {
      "term": {
        "_id": {
          "value": "1"
        }
      }
    }
  }
}

# terms
GET {my_index}/_search
{
  "query": {
     "terms": {
       "_id": [
         "1","2"
       ]
     }
    }
  }
}

# match
GET {my_index}/_search
{
  "query": {
      "match": {
        "_id": 1
      }
    }
  }
}
```


ç»„åˆæŸ¥è¯¢ï¼š


```json
{  "query": {    "bool": {      "must": [        {          "term": {            "poiId": "142958687180976"          }        },        {          "term": {            "skuId": "100176717278999"          }        }      ],      "must_not": [],      "should": [        {          "term": {            "shelfCode": "CW-01-01-01-01"          }        },        {          "term": {            "newShelfCode": "CW-01-01-01-01"          }        }      ],      "filter": []    }  },  "from": 0,  "size": 10,  // æŒ‡å®šæ’åº  "sort": [    // æœ€å¥½æŒ‡å®šå•å€¼çš„å­—æ®µè¿›è¡Œæ’åºï¼Œä¸è¦æŒ‡å®šæ•°ç»„æˆ–å¤šå€¼å­—æ®µè¿›è¡Œæ’åºï¼Œä¸ç¡®å®šç³»ç»Ÿä¼šé€‰æ‹©å“ªä¸€ä¸ªå…ƒç´ è¿›è¡Œæ’åº    {"create_at" : "asc"},  // å…ˆæŒ‰ç…§æ—¥å¿—æ­£åºæ’åº    {"name" : "desc"},      // ç„¶åæŒ‰ç…§åå­—å€’å™æ’åº    "_score"                            // æœ€åæŒ‰ç…§åŒ¹é…çš„ç›¸å…³æ€§åˆ†æ•°è¿›è¡Œæ’åº  ],  "profile": false}
```


### æŸ¥è¯¢è¿”å›æŒ‡å®šçš„å­—æ®µ


ä¸è¿”å›æ–‡æ¡£ï¼š


```json
GET /_search{    "_source": false,    "query" : {        "term" : { "user" : "kimchy" }    }}
```


è¿”å›æŒ‡å®šçš„å­—æ®µï¼ˆæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼‰ï¼š


```json
GET /_search{    "_source": {        // è¿”å›ä»¥obj1.å’Œobj2.å¼€å¤´çš„å­—æ®µ        "includes": [ "obj1.*", "obj2.*" ],        // æ’é™¤ä»¥descriptionç»“å°¾çš„å­—æ®µ        "excludes": [ "*.description" ]    },    "query" : {        "term" : { "user" : "kimchy" }    }}
```


æˆ–è€…


```json
GET /_search{     "_source": ["shelfId"],    "query" : {        "term" : { "user" : "kimchy" }    }}
```


Java:


```java
# source è¿‡æ»¤String[] includeFields = new String[] {"test1", "test2"};String[] excludeFields = new String[] {"test1", "test2"};sourceBuilder.fetchSource(includeFields, excludeFields);
```


### æŸ¥è¯¢å™¨å’Œè¿‡æ»¤å™¨


æŸ¥è¯¢å™¨å’Œè¿‡æ»¤çƒåœ¨è¯„åˆ†æœºåˆ¶å’Œæœç´¢è¡Œä¸ºçš„æ€§èƒ½ä¸Šä¸åŒï¼Œæœç´¢çš„è¿‡æ»¤å™¨åªæ˜¯ä¸ºâ€œæ–‡æ¡£æ˜¯å¦åŒ¹é…è¿™ä¸ªæŸ¥è¯¢â€ï¼Œè¿”å›ç®€å•çš„æ˜¯æˆ–å¦ã€‚ç”±äºä¸è®¡ç®—å¾—åˆ†ï¼Œè¿‡æ»¤å™¨æ‰€éœ€çš„å¤„ç†æ›´å°‘ï¼Œå¹¶ä¸”å¯ä»¥è¢«ç¼“å­˜ã€‚


### 1 match_allæŸ¥è¯¢


è¿™ä¸ªæŸ¥è¯¢åŒ¹é…æ‰€æœ‰çš„æ–‡æ¡£ã€‚


### 2 query_stringæŸ¥è¯¢


query_stringæŸ¥è¯¢é»˜è®¤ä¼šæœç´¢`_all`å­—æ®µï¼Œå³å¯¹æ‰€æœ‰å­—æ®µè¿›è¡Œæœç´¢æŸ¥è¯¢æŸä¸ªå…³é”®å­—ã€‚


å¯ä»¥æŒ‡å®šé»˜è®¤çš„æŸ¥è¯¢å­—æ®µï¼Œä¾‹å¦‚ï¼š


```text
GET kibana_sample_data_flights/_search
```


```json
{  "query": {    "query_string": {      // é»˜è®¤æŸ¥è¯¢Destå­—æ®µ      "default_field": "Dest",      "query": "(Mariscal Sucre International Airport)"    }  }}
```


è¿™ç§æŸ¥è¯¢ä¸åªæ˜¯æä¾›å•ä¸ªå…³é”®å­—æŸ¥è¯¢é‚£ä¹ˆç®€å•ï¼Œå…¶å†…éƒ¨æ˜¯æ•´ä¸ªLuceneçš„æŸ¥è¯¢è¯­æ³•ï¼Œå…è®¸ä½¿ç”¨ANDå’ŒORè¿™æ ·çš„å¸ƒå°”æ“ä½œæ¥ç»„åˆè¯æ¡çš„æœç´¢ã€‚


```json
GET kibana_sample_data_flights/_search{  "query": {    "query_string": {      "default_field": "Dest",      "query": "(Mariscal Sucre International Airport) OR (Sheremetyevo International Airport)"    }  }}
```


### 3 termæŸ¥è¯¢å’Œtermè¿‡æ»¤å™¨


ç”±äºè¢«æœç´¢çš„è¯æ¡æ˜¯æ²¡æœ‰ç»è¿‡åˆ†æçš„ï¼Œæ–‡æ¡£ä¸­çš„è¯æ¡å¿…é¡»ç²¾ç¡®åŒ¹é…æ‰èƒ½ä½œä¸ºç»“æœè¿”å›ã€‚termè¿‡æ»¤å™¨è¿”å›çš„æ‰€æœ‰æ–‡æ¡£çš„`_score`å­—æ®µéƒ½ä¸º1ï¼Œè¡¨ç¤ºæ²¡æœ‰ç»è¿‡è®¡ç®—å¾—åˆ†ã€‚


### 4 termsæŸ¥è¯¢


termsæŸ¥è¯¢å¯ä»¥æœç´¢æŸä¸ªæ–‡æ¡£å­—æ®µä¸­çš„å¤šä¸ªè¯æ¡ã€‚å¤šä¸ªè¯æ¡æ»¡è¶³ä¸€ä¸ªæ¡ä»¶å°±ä¼šè¿”å›æ–‡æ¡£ã€‚


> termsæŸ¥è¯¢æœ€å¤§æ•°é‡æœ‰é™åˆ¶å—ï¼Ÿ


	By default, Elasticsearch limits the terms query to a maximum of **65,536 terms**. You can change this limit using the index.


### 5 matchæŸ¥è¯¢


matchæŸ¥è¯¢æ˜¯ä¸€ä¸ªæ•£åˆ—æ˜ å°„ï¼ŒåŒ…å¥½äº†å¸Œæœ›æœç´¢çš„å­—æ®µå’Œå­—ç¬¦ä¸²ã€‚


å¸ƒå°”æŸ¥è¯¢è¡Œä¸ºï¼š


é»˜è®¤æƒ…å†µä¸‹ï¼ŒmatchæŸ¥è¯¢ä½¿ç”¨å¸ƒå°”è¡Œä¸ºå’ŒORæ“ä½œç¬¦ã€‚ä¾‹å¦‚ï¼Œæœç´¢æ–‡æœ¬â€œElasticSearch Denverâ€ï¼ŒElasticSearchä¼šæœç´¢â€œElasticSearch OR Denverâ€ï¼ŒåŒæ—¶åŒ¹é…â€œElasticSearch AmsterDamâ€å’Œâ€œDenver Clojure Groupâ€è¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æ–‡æ¡£ã€‚


```json
POST /_search -d{   "from":10,   "size":5,   "query":{      "match":{         "eventname":"azure aws cloud"      }   }}
```


å¯ä»¥å¯¹å­—æ®µä½¿ç”¨æ˜ å°„ï¼Œè®¾ç½®æŒ‡å®šçš„operator:


```json
POST /search -d{   "from":10,   "size":5,   "query":{      "match":{         "eventname":{            "query":"azure aws cloud security",            "operator":"or",            "minimum_should_match":2         }      }   }}
```

- **operator**ï¼šç”¨æ¥æ§åˆ¶matchæŸ¥è¯¢åŒ¹é…è¯æ¡çš„é€»è¾‘æ¡ä»¶ï¼Œé»˜è®¤å€¼æ˜¯orï¼Œå¦‚æœè®¾ç½®ä¸ºandï¼Œè¡¨ç¤ºæŸ¥è¯¢æ»¡è¶³æ‰€æœ‰æ¡ä»¶ï¼›
- **minimum_should_match**ï¼šå½“operatorå‚æ•°è®¾ç½®ä¸ºoræ—¶ï¼Œè¯¥å‚æ•°ç”¨æ¥æ§åˆ¶åº”è¯¥åŒ¹é…çš„åˆ†è¯çš„æœ€å°‘æ•°é‡ï¼›

### 6 ç»„åˆæŸ¥è¯¢


muståµŒå¥—shouldä½¿ç”¨ï¼š


```json
"query": {    "bool": {        "must": [            {                "bool": {                    "should": [                        {"match": {"look_user": "test1"}},                        {"match": {"userId": "test2"}}                    ]                }            },            {"terms": {"status": 1}},            {"match": {"verify": 2}}        ]    }}
```


### 7 å­˜åœ¨æŸ¥è¯¢


[æŸä¸ªå­—æ®µå­˜åœ¨æŸ¥è¯¢æˆ–ä¸å­˜åœ¨æŸ¥è¯¢_sxf_0123çš„åšå®¢-CSDNåšå®¢_elasticsearch æŸ¥è¯¢å­—æ®µæ˜¯å¦å­˜åœ¨](https://blog.csdn.net/sxf_123456/article/details/81532570)


è¯ç»„(phrase)æŸ¥è¯¢è¡Œä¸ºï¼š


åœ¨æ–‡æ¡£ä¸­æœç´¢æŒ‡å®šçš„è¯ç»„æ—¶ï¼ŒphraseæŸ¥è¯¢éå¸¸æœ‰ç”¨ï¼Œåœ¨æ¯ä¸ªå•è¯ä½ç½®ä¹‹é—´å¯ä»¥ç•™æœ‰ä½™åœ°ã€‚è¿™ç§ä½™åœ°ç§°ä¸ºslopï¼Œç”¨äºè¡¨ç¤ºè¯ç»„ä¸­å¤šä¸ªåˆ†è¯ä¹‹é—´çš„è·ç¦»ã€‚ä¹Ÿå«åšmatch_phraseæŸ¥è¯¢ã€‚


ä¾‹å¦‚ï¼ŒåŠ å…¥ä½ åªè®°å¾—æŸä¸ªå­—æ®µåŒ…å«â€œEnglishâ€å’Œâ€œChineseâ€è¿™ä¸¤ä¸ªè¯ï¼Œä½†æ˜¯ä¸è®°å¾—è¿™ä¸¤ä¸ªè¯ä¸­é—´çš„éƒ¨åˆ†äº†ï¼Œå¯ä»¥å°†slopè®¾ç½®ä¸º1æˆ–è€…2ï¼Œè€Œä¸æ˜¯é»˜è®¤çš„0ï¼Œè¿™æ ·å°±å¯ä»¥è¿›è¡ŒæŸ¥è¯¢ç±»ä¼¼â€œEnglish and Chinese is goodâ€è¿™ç§å­—æ®µçš„å€¼ã€‚


```json
GET matchphasetest/_search{  "query": {    "match_phrase": {      "message": {        "query": "I like riding",        "slop": 2      }    }  }}
```


phrase_prefixæŸ¥è¯¢ï¼š


å’Œmatch_phraseæŸ¥è¯¢ç±»ä¼¼ï¼Œä½†æ˜¯phrase_prefixæŸ¥è¯¢æ˜¯**å’Œè¯ç»„çš„æœ€åä¸€ä¸ªè¯æ¡è¿›è¡Œå‰ç¼€åŒ¹é…**ã€‚


> å¯¹åº”æœç´¢æ¡†çš„è‡ªåŠ¨è¡¥å…¨åŠŸèƒ½ï¼Œè¿™ä¸ªè¡Œä¸ºéå¸¸æœ‰ç”¨ã€‚


å¯ä»¥è®¾ç½®max_expansionsæ¥è®¾ç½®æœ€å¤§çš„å‰ç¼€æ‹“å±•æ•°é‡ã€‚


```json
GET matchphasetest/_search{  "query": {    "match_phrase_prefix": {      "message": "I like swi"    }  }}
```


ä¸Šé¢çš„æŸ¥è¯¢å¯ä»¥åŒ¹é…åˆ°`I like swimming and riding`ã€‚ä¸Šé¢çš„æŸ¥è¯¢è¯­å¥è¡¨ç¤ºæŸ¥è¯¢messageå­—æ®µä¸­å­˜åœ¨â€œIâ€å’Œâ€œlikeâ€å­—æ®µï¼Œå¹¶ä¸”å­˜åœ¨ä»¥â€œswiâ€å¼€å¤´çš„è¯ç»„çš„æ–‡æ¡£ã€‚


multi_matchæŸ¥è¯¢ï¼š


multi_matchæŸ¥è¯¢å…è®¸æœç´¢å¤šä¸ªå­—æ®µä¸­çš„å€¼ï¼Œå³å¯ä»¥åŒæ—¶åœ¨å¤šä¸ªå­—æ®µä¸­æœç´¢ç›¸åŒçš„å€¼ã€‚


```json
GET /_search{  "query": {    "multi_match" : {      "query":    "this is a test", // æŸ¥è¯¢çš„å€¼      "fields": [ "subject", "message" ] // æŸ¥è¯¢çš„å¤šä¸ªå­—æ®µ    }  }}
```


### filteræŸ¥è¯¢å’ŒtermæŸ¥è¯¢çš„åŒºåˆ«


termæŸ¥è¯¢ä¼šè®¡ç®—å¾—åˆ†ï¼ŒfilteræŸ¥è¯¢ä¸è®¡ç®—å¾—åˆ†


### ç»„åˆæŸ¥è¯¢å’Œå¤åˆæŸ¥è¯¢


### boolæŸ¥è¯¢


boolæŸ¥è¯¢å…è®¸ä½ å†å•ç‹¬çš„æŸ¥è¯¢ä¸­ç»„åˆä»»æ„æ•°é‡çš„æŸ¥è¯¢ï¼ŒæŒ‡å®šçš„æŸ¥è¯¢å­å¥è¡¨æ˜å“ªäº›éƒ¨åˆ†æ˜¯å¿…é¡»(must)åŒ¹é…ã€åº”è¯¥(should)åŒ¹é…æˆ–è€…æ˜¯ä¸èƒ½(must_not)åŒ¹é…ä¸ŠESç´¢å¼•é‡Œçš„æ•°æ®ã€‚


### rangeæŸ¥è¯¢å’Œè¿‡æ»¤å™¨


rangeæŸ¥è¯¢æŒ‡å®šä¸€ä¸ªèŒƒå›´è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™ä¸ªèŒƒå›´å¯ä»¥æ—¶é—´ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªæ•°å€¼çš„èŒƒå›´ã€‚


```json
GET _search{    "range" : {        "age" : {            "gte" : 10,            "lte" : 20,            "boost" : 2.0        }    }}
```


èŒƒå›´æŸ¥è¯¢æ¥å—ä»¥ä¸‹å‚æ•°ï¼š


| å‚æ•°    | è¯´æ˜                     |
| ----- | ---------------------- |
| gte   | å¤§äºæˆ–ç­‰äº                  |
| gt    | å¤§äº                     |
| lte   | å°äºæˆ–ç­‰äº                  |
| lt    | å°äº                     |
| boost | è®¾ç½®æŸ¥è¯¢çš„_boost_å€¼ï¼Œé»˜è®¤ä¸º_1.0_ |


ä¸ºäº†è€ƒè™‘æ€§èƒ½ï¼Œæœ€å¥½åˆ¤æ–­ä¸‹èŒƒå›´æŸ¥è¯¢æ˜¯å¦åº”è¯¥ä½¿ç”¨è¿‡æ»¤å™¨è¿›è¡ŒæŸ¥è¯¢ã€‚


### prefixæŸ¥è¯¢å’Œè¿‡æ»¤å™¨


prefixæŸ¥è¯¢å’Œè¿‡æ»¤å™¨å…è®¸é€šè¿‡ç»™å®šçš„å‰ç¼€æ¥æœç´¢è¯æ¡ï¼Œè¿™é‡Œå‰ç¼€åœ¨æœç´¢ä¹‹å‰æ˜¯æ²¡æœ‰ç»è¿‡åˆ†æçš„ã€‚å³å¦‚æœæŸ¥è¯¢Liberè€Œä¸æ˜¯liberï¼Œæ˜¯ä¸èƒ½ä»ESä¸­æŸ¥è¯¢åˆ°liberçš„ã€‚


æŸ¥è¯¢æ ¼å¼:


```json
get xxx/{    "query" : {        "prefix" : {        "title" : "liber"      }  }}
```


### wildcardæŸ¥è¯¢


è¿™æ˜¯ä¸€ç§é€šé…ç¬¦æŸ¥è¯¢å·¥ä½œæ–¹å¼ã€‚æ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ã€‚


wildcardæŸ¥è¯¢ä¸æƒ³matchç­‰å…¶ä»–æŸ¥è¯¢é‚£æ ·è½»é‡çº§ï¼Œå½“åŒ¹é…çš„å­—ç¬¦ä¸²å¾ˆé•¿æ—¶ï¼Œå¯èƒ½éœ€è¦åˆ›å»ºå·¨å¤§çš„çŠ¶æ€æœºã€‚


### å­˜åœ¨æŸ¥è¯¢


### existsè¿‡æ»¤å™¨


åªæŸ¥æ‰¾åœ¨ç‰¹å®šå­—æ®µæœ‰å€¼çš„æ–‡æ¡£ï¼Œæ— è®ºå…¶å€¼æ˜¯å¤šå°‘ã€‚


### missingè¿‡æ»¤å™¨


æœç´¢æŒ‡å®šå­—æ®µæ²¡æœ‰å€¼çš„æ–‡æ¡£ã€‚


### shouldæŸ¥è¯¢


### åˆ†é¡µæŸ¥è¯¢


### from-sizeæŸ¥è¯¢


ES æ™®é€šçš„åˆ†é¡µæŸ¥è¯¢æœ‰æ·±åˆ†é¡µé™åˆ¶ï¼Œé»˜è®¤æ˜¯10000æ¡,é»˜è®¤åˆ†é¡µæ–¹å¼from+sizeã€‚


### ScrollæŸ¥è¯¢


> å‚è€ƒï¼šElasticsearchçš„æ»šåŠ¨æŸ¥è¯¢â€”Scrollï¼Œè§£å†³ESæ¯æ¬¡æœ€å¤šæŸ¥ä¸€ä¸‡ç¬”æ•°æ®çš„é—®é¢˜ - çŸ¥ä¹


	[Elasticsearch ä¸‰ç§åˆ†é¡µæ–¹å¼çš„æ€»ç»“_Nicholasçš„ä¸“æ -ç¨‹åºå‘˜ä¿¡æ¯ç½‘_elasticsearchåˆ†é¡µ - ç¨‹åºå‘˜ä¿¡æ¯ç½‘](https://www.i4k.xyz/article/zhongbeida_xue/108267496)


	[Eså› scrollæŸ¥è¯¢å¼•èµ·çš„gcé—®é¢˜ - è…¾è®¯äº‘å¼€å‘è€…ç¤¾åŒº-è…¾è®¯äº‘](https://cloud.tencent.com/developer/article/1536437)


	[å¹²è´§ | å…¨æ–¹ä½æ·±åº¦è§£è¯» Elasticsearch åˆ†é¡µæŸ¥è¯¢ - å¢¨å¤©è½®](https://www.modb.pro/db/61574#:~:text=search_after%20%E6%9F%A5%E8%AF%A2%E6%9C%AC%E8%B4%A8%EF%BC%9A%E4%BD%BF%E7%94%A8%E5%89%8D,%E6%9C%89%E7%BB%93%E6%9E%9C%E9%9B%86%E6%9E%84%E6%88%90%E5%BD%B1%E5%93%8D%E3%80%82)


Scrollæ˜¯å…ˆåšä¸€æ¬¡åˆå§‹åŒ–æœç´¢æŠŠæ‰€æœ‰ç¬¦åˆæœç´¢æ¡ä»¶çš„ç»“æœç¼“å­˜èµ·æ¥ç”Ÿæˆä¸€ä¸ªå¿«ç…§ï¼Œç„¶åæŒç»­åœ°ã€æ‰¹é‡åœ°ä»å¿«ç…§é‡Œæ‹‰å–æ•°æ®ç›´åˆ°æ²¡æœ‰æ•°æ®å‰©ä¸‹ã€‚è€Œè¿™æ—¶å¯¹ç´¢å¼•æ•°æ®çš„æ’å…¥ã€åˆ é™¤ã€æ›´æ–°éƒ½ä¸ä¼šå½±å“éå†ç»“æœï¼Œå› æ­¤scroll å¹¶ä¸é€‚åˆç”¨æ¥åšå®æ—¶æœç´¢ã€‚


åœ¨ç¬¬ä¸€æ¬¡æœç´¢çš„æ—¶å€™ï¼Œä¿å­˜è§†å›¾å¿«ç…§ï¼Œä¹‹ååŸºäºè§†å›¾å¿«ç…§æä¾›æ•°æ®


### search after æŸ¥è¯¢


å¯ä»¥æŸ¥è¯¢åˆ°å®æ—¶æ•°æ®ï¼Œæ€§èƒ½ä¼˜ç§€ï¼›ä¸èƒ½æŒ‡å®šé¡µæ•°ï¼Œåªèƒ½ä¸€é¡µæŒ¨ä¸€é¡µé—®ä¸‹æŸ¥ã€‚ç¬¬ä¸€æ¬¡æŸ¥è¯¢æ—¶å¸¦ä¸Šsortï¼Œè¿”å›æœ€åä¸€ä¸ªæ–‡æ¡£çš„idã€‚ä¸‹ä¸€æ¬¡æŸ¥è¯¢å¸¦ä¸Šsearch afterå‚æ•°ã€‚


### profile API


[Profile API | Elasticsearch Guide [8.4] | Elastic](https://www.elastic.co/guide/en/elasticsearch/reference/current/search-profile.html)


[ESæ…¢æŸ¥è¯¢ä¼˜åŒ–æ–¹æ¡ˆ profile API - æ˜é‡‘](https://juejin.cn/post/6984611941469650957)


Profile API ç”¨äºå®šä½æŸ¥è¯¢è¿‡ç¨‹ä¸­çš„å¼‚å¸¸è€—æ—¶é—®é¢˜çš„ã€‚å¯ä»¥é€šè¿‡åœ¨ query éƒ¨åˆ†ä¸Šæ–¹æä¾› â€œprofile: trueâ€ æ¥å¯ç”¨Profile APIã€‚


### åº”ç”¨èšé›†


ç±»ä¼¼MySQLä¸­çš„countè®¡ç®—ï¼š


å…³é”®å­—ï¼šaggregations


### å»é‡


ä½¿ç”¨collapseæŠ˜å å­—æ®µ


```json
POST /user_onoffline_log/{    "query":{        "match_all":{        }    },    "collapse":{        "field":"uid"    }}
```


æŠ˜å åªä¼šå½±å“æœç´¢ç»“æœHitsçš„æ•°é‡ï¼Œä½†ä¸å½±å“èšåˆTotal æ€»æ•°ï¼Œæœç´¢ç»“æœçš„ Total ä¾æ—§æ˜¯æ‰€æœ‰çš„å‘½ä¸­çºªå½•æ•°ï¼Œå»é‡çš„ç»“æœæ•°æ— æ³•å–åˆ°ã€‚


[Elasticsearch Collapsing å­—æ®µæŠ˜å ä½¿ç”¨è¯¦è§£_å­—æ®µæŠ˜å åæ•°é‡ç»“æœTotalä¸å‡†ç¡®è§£å†³æ–¹æ³•_èƒ¡è€æ±‰çš„åšå®¢-CSDNåšå®¢](https://blog.csdn.net/qq_27559331/article/details/103769385)


Java


```java
searchRequest.source().collapse(new CollapseBuilder("field"));
```


### å…¬å…±å‚æ•°è®¾ç½®


### ç»“æœè¿‡æ»¤å‚æ•°filter_path


ä½¿ç”¨ä¾‹å­ï¼š


```text
GET /_search?q=elasticsearch&filter_path=took,hits.hits._id,hits.hits._score
```


è¾“å‡ºç»“æœæ ·ä¾‹ï¼š


```json
{  "took" : 3,  "hits" : {    "hits" : [      {        "_id" : "0",        "_score" : 1.6375021      }    ]  }}
```


ä¹Ÿæ”¯æŒä½¿ç”¨é€šé…ç¬¦ `*` è¿›è¡ŒåŒ¹é…ï¼š


```text
GET /_cluster/state?filter_path=metadata.indices.*.stat*
```


ç»“æœï¼š


```json
{  "metadata" : {    "indices" : {      "twitter": {"state": "open"}    }  }}
```

- `*` å¯ç”¨äºåœ¨ä¸çŸ¥é“å­—æ®µçš„ç¡®åˆ‡è·¯å¾„çš„æƒ…å†µä¸‹åŒ…å«å­—æ®µã€‚

```text
GET /_cluster/state?filter_path=metadata.**.stat*
```


### é“ºå¹³å‚æ•°flat_settings


ä½¿ç”¨ `flat_settings` å‚æ•°ï¼Œå¹¶ä¸”è®¾ç½®ä¸º `true` å¯ä»¥è®©è¿”å›çš„çš„Jsonæ•°æ®å±•å¼€ï¼Œå‡å°‘èŠ±æ‹¬å·ã€‚


ä½¿ç”¨æ–¹å¼ï¼šGetæ–¹æ³•åé¢æ·»åŠ  `?flat_settings=true`


åŸæ¥ï¼š `/indexName/_settings`


```json
{  "grocery_inventory_inventory_transaction_143179120435102_202108": {        "settings": {            "index": {                "refresh_interval": "1s",                "number_of_shards": "1",                "provided_name": "grocery_inventory_inventory_transaction_143179120435102_202108",                "creation_date": "1628582799738",                "number_of_replicas": "1",                "uuid": "lm22sPdbSrmGuaqIg03QOg",                "version": {                    "created": "5060399"                }            }        }    }}
```


ä½¿ç”¨åï¼š `/indexName/_settings?flat_settings=true`


```json
{  "grocery_inventory_inventory_transaction_143179120435102_202108": {        "settings": {            "index.creation_date": "1628582799738",            "index.refresh_interval": "1s",            "index.uuid": "lm22sPdbSrmGuaqIg03QOg",            "index.version.created": "5060399",            "index.provided_name": "grocery_inventory_inventory_transaction_143179120435102_202108",            "index.number_of_replicas": "1",            "index.number_of_shards": "1"        }    }}
```


### è¯·æ±‚å‚æ•°æŸ¥è¯¢


æ ¹æ®æ¡ä»¶æŸ¥è¯¢ç´¢å¼•ä¿¡æ¯ï¼š


```text
GET /twitter/_doc/_search
{
    "query" : {
        "term" : { "user" : "kimchy" }
    }
}
```


### ReIndex


Reindexçš„ç›®æ ‡æ˜¯æŠŠç´¢å¼•æ•°æ®ä»ä¸€ä¸ªç´¢å¼•è¿ç§»è‡³å¦ä¸€ä¸ªç´¢å¼•ï¼Œä¸»è¦é’ˆå¯¹äº**ç´¢å¼•å˜æ›´**ï¼Œæ¯”å¦‚éœ€è¦**ä¿®æ”¹å­—æ®µç±»å‹ï¼Œæ–°å¢å­—æ®µ**ç­‰éœ€æ±‚ã€‚


åŸºæœ¬å‘½ä»¤ï¼š


```text
POST /_reindex
{
    "source": {
        "index": "old_index"
    },
    "dest": {
        "index": "new_index"
    }
}
```


å¤æ‚å‘½ä»¤ï¼š


```text
POST /_reindex
{
    "source": {
        "remote": {
            "host": "http://$HOST:8080",
            "username": "$APP",
            "password": "$ACCESSKEY"
        },
        "index": "old_index",
        "query": {
            "bool": {
                "must": [{
                    "match_all": {}
                }],
                "must_not": [],
                "should": [],
                "filter": []
            }
        }
    },
    "dest": {
        "index": "new_index"
    }
}
```


åŒæ­¥å¢é‡æ•°æ®å‘½ä»¤:


```text
POST /_reindex
{
  "conflicts": "proceed",
  "source": {
    "index": "inventory_cost_record",
    "query": {
      "bool": {
        "must": [
          {
            "range": {
              "bizTime": {
                "gt": "2022-01-17 00:00:00",
                "lt": "2022-01-19 00:00:00"
              }
            }
          }
        ]
      }
    },
    "size": 500
  },
  "dest": {
    "index": "cost_accounting_record",
    "version_type": "external",
    "op_type": "create"
  }
}
```


> version_typeå­—æ®µè¯´æ˜:

	- ã€é»˜è®¤è¦†ç›–ã€‘å¿½ç•¥version_typeå­—æ®µï¼Œæˆ–é…ç½®ä¸ºâ€œinternalâ€ï¼ˆ**é»˜è®¤**é…ç½®ï¼‰ï¼šå°†æ–‡æ¡£å®Œå…¨dumpåˆ°ç›®çš„ç´¢å¼•ï¼Œ**è¦†ç›–**å…·æœ‰ç›¸åŒç±»å‹å’Œidçš„ä»»ä½•æ–‡æ¡£å†…å®¹ï¼Œä¸ä¼šäº§ç”Ÿå†²çªé—®é¢˜ï¼›
	- ã€ä¿ç•™æœ€æ–°ã€‘é…ç½®ä¸ºâ€œexternalâ€ï¼šesä»æºæ–‡ä»¶ä¸­è¯»å–versionå­—æ®µï¼Œå½“é‡åˆ°ç›¸åŒç±»å‹å’Œidçš„æ–‡æ¡£æ—¶ï¼Œåªä¿ç•™newer versionï¼Œå³æœ€æ–°çš„versionå¯¹åº”çš„æ•°æ®ã€‚åˆ›å»ºç›®æ ‡ç´¢å¼•ä¸­ç¼ºå¤±çš„æ‰€æœ‰æ–‡æ¡£ï¼Œå¹¶**æ›´æ–°**åœ¨ç›®æ ‡ç´¢å¼•ä¸­æ¯”åŸç´¢å¼•ä¸­ç‰ˆæœ¬æ›´è€çš„æ‰€æœ‰æ–‡æ¡£ï¼›
	- ã€å†²çªæ•°æ®æ— æ³•å†™å…¥ã€‘op_typeé…ä¸ºâ€œcreateâ€ï¼šä»…åœ¨ç›®æ ‡ç´¢å¼•ä¸­åˆ›å»ºç¼ºå°‘çš„æ–‡æ¡£ã€‚æ‰€æœ‰å­˜åœ¨çš„æ–‡æ¡£å°†å¯¼è‡´ç‰ˆæœ¬å†²çªã€‚(åœ¨ä½¿ç”¨äº†op_typeä¸ºcreateçš„æƒ…å†µä¸‹ï¼Œé»˜è®¤ç‰ˆæœ¬å†²çªå°†ä¸­æ­¢â€œ_reindexâ€è¿›ç¨‹ï¼Œä½†å¯ä»¥é€šè¿‡è®¾ç½®â€œconflict:proceedâ€æ¥åœ¨å†²çªæ—¶è¿›è¡Œè®¡æ•°ã€‚å³ä½¿å†²çªï¼Œä»èƒ½å¤Ÿæ­£å¸¸è¿›è¡Œreindexï¼Œä½†ä¼šé—æ¼æœ‰å†²çªçš„æ•°æ®ã€‚)

### Mapping


mappingåˆ›å»ºä¹‹åï¼Œè¿˜èƒ½è¿›è¡Œæ›´æ–°å—ï¼Ÿ


å·²ç»å®šä¹‰çš„å­—æ®µå¤§å¤šæ•°æƒ…å†µä¸èƒ½è¢«æ›´æ–°ï¼Œé™¤é reindex æ›´æ–° mappingï¼Œä¸‹é¢çš„æƒ…å†µæ˜¯ä¾‹å¤–ï¼š

- Object å¯¹è±¡å¯ä»¥æ·»åŠ æ–°çš„å±æ€§ï¼šæ·»åŠ è¡Œçš„å­—æ®µæ˜ å°„å±æ€§ä¸å½±å“ç°æœ‰çš„ç›¸å…³æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥è¿›è¡Œæ·»åŠ 
- å·²ç»å­˜åœ¨çš„fieldsé‡Œé¢å¯ä»¥æ·»åŠ fieldsï¼Œä»¥æ„æˆä¸€ä¸ªå­—æ®µå¤šç§ç±»å‹
- ignore_above æ˜¯å¯ä»¥æ›´æ–°çš„

ä¸Šé¢å¯ä»¥å¾—çŸ¥ï¼Œåœ¨ä¸å½±å“ç°æœ‰æ•°æ®çš„æƒ…å†µä¸‹ï¼Œæ˜¯å¯ä»¥æ·»åŠ æ–°çš„å±æ€§æ˜ å°„çš„ï¼Œä½†æ˜¯å¦‚æœå…¥éœ€è¦ä¿®æ”¹ç°æœ‰çš„å±æ€§æ˜ å°„(ä¾‹å¦‚åŸæ¥ç±»å‹æ˜¯longéœ€è¦æ”¹æˆstring)ï¼Œå› ä¸ºæ­¤æ—¶å·²ç»æœ‰éƒ¨åˆ†æ•°æ®æ˜¯longç±»å‹çš„æ•°æ®ï¼Œæ”¹æˆstringå°±ä¼šå‡ºç°åŒä¸€ä¸ªå­—æ®µå­˜åœ¨ä¸¤ç§ç±»å‹ï¼Œè¿™æ ·æ˜¯ä¼šç¦æ­¢çš„ã€‚


å±æ€§è®¾ç½®ï¼šåœ¨mappingè®¾ç½®å±æ€§å­—æ®µæ˜¯å¦éœ€è¦ç´¢å¼•ã€æ˜¯å¦éœ€è¦è¿›è¡Œåˆ†æï¼Œä¾‹å¦‚ï¼š


```json
{    "properties": {        "name": {            "type": "string",            "index": "no_analyzed"            // "index":"no"            // "index":"analyzed"        }    }}
```

- é»˜è®¤æ˜¯analyzedï¼Œè¡¨ç¤ºè¿›è¡Œç´¢å¼•ï¼Œå¹¶ä¸”åŠ å…¥åˆ†è¯åˆ†æï¼Œä¾‹å¦‚â€œHello ElasticSeachâ€ ä¼šè½¬åŒ–ä¸ºå°å†™å¹¶ä¸”è¿›è¡Œåˆ†è¯æˆâ€œhelloâ€å’Œâ€œelasticsearchâ€è¿›è¡Œå­˜å‚¨
- no_analyzedè¡¨ç¤ºè¿›è¡Œç´¢å¼•ï¼Œä½†æ˜¯ä¸è¿›è¡Œåˆ†è¯åˆ†æï¼Œåªæ˜¯å°†åŸæœ¬çš„å­—ç¬¦ä¸²è¿›è¡Œç´¢å¼•å­˜å‚¨
- noè¡¨ç¤ºä¸éœ€è¦è¿›è¡Œç´¢å¼•çš„æœç´¢ï¼Œè¿™ä¸ªé€‰é¡¹å¯ä»¥èŠ‚çœç©ºé—´

> é—®é¢˜ï¼š


	å¦‚æœåœ¨ç´¢å¼•çš„æ—¶å€™ï¼Œâ€œElasticSearchâ€æ²¡æœ‰ç»è¿‡åˆ†è¯åˆ†æï¼Œé‚£ä¹ˆå­˜å‚¨åœ¨ESä¸­å°±æ˜¯åŸæ¥çš„â€œElasticSearchâ€è¿™ä¸ªå­—ç¬¦ä¸²ï¼Œå½“æ‰§è¡ŒæŸ¥è¯¢`get /xxx/_search?q=ElasticSearch`æ—¶ï¼Œä¼šè‡ªåŠ¨å°†â€œElasticSearchâ€è½¬ä¸ºå°å†™â€œelasticsearchâ€ï¼Œç„¶åå†å»æŸ¥æ‰¾ï¼Œæ­¤æ—¶å°±ä¼šæŸ¥æ‰¾ä¸åˆ°ã€‚


	å“ªäº›æŸ¥è¯¢ç±»å‹åˆ†æäº†æŸ¥è¯¢è¾“å…¥çš„æ–‡æœ¬ï¼Œè€Œå“ªäº›æ²¡æœ‰ï¼Ÿ


### ç±»å‹


### æ•°å­—ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹


åŒ…æ‹¬æ•°å­—ç±»å‹ï¼šbyteã€shortã€intã€longã€floatã€doubleå’Œå­—ç¬¦ä¸²ç±»å‹string


### æ—¥æœŸç±»å‹


dataæ—¥æœŸç±»å‹ç”¨äºå­˜å‚¨æ—¥æœŸå’Œæ—¶é—´ã€‚è¿™ä¸ªç±»å‹é€šå¸¸åœ¨ESä¸­å±•ç¤ºçš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ä¾‹å¦‚`2022-03-27T14:42:03+08:00`ï¼Œç„¶åESå†…éƒ¨ä¼šå¯¹è¿™ä¸ªå­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œè½¬åŒ–ä¸ºlongçš„æ•°å€¼å­˜å…¥Luceneç´¢å¼•ã€‚


å½“æœç´¢çš„æ—¶å€™ï¼Œæä¾›å­—ç¬¦ä¸²çš„æ—¥æœŸæ ¼å¼ä¼ ç»™ESï¼ŒESå†…éƒ¨ä¼šè‡ªåŠ¨è§£ææˆlongç±»å‹çš„æ•°å€¼è¿›è¡Œæœç´¢ã€‚


> å’Œå­—ç¬¦ä¸²ç›¸æ¯”ï¼Œä½¿ç”¨æ•°å€¼ç±»å‹å­˜å‚¨å’Œæœç´¢æ›´åŠ å¿«å¹¶ä¸”æ›´åŠ èŠ‚çœç©ºé—´


```json
{    "properties": {        "beginTime": {            "type": "date",            "format": "MMMM DD YYYY"        }    }}
```


### å¸ƒå°”ç±»å‹


booleanç±»å‹ç”¨äºå­˜å‚¨æ–‡æ¡£ä¸­çš„çœŸå‡å€¼ã€‚booleanç±»å‹çš„å­—æ®µåœ¨Luceneç´¢å¼•ä¸­æ˜¯è¿™æ ·å­˜å‚¨çš„ï¼štrueä¼šè½¬ä¸ºTï¼Œfalseä¼šè½¬ä¸ºFï¼Œç„¶åå†è¿›è¡Œç´¢å¼•å­˜å‚¨åˆ°Luceneã€‚


### æ•°ç»„ç±»å‹


ä¸éœ€è¦å†æ˜ å°„å­—æ®µä¸­æ˜¾ç¤ºå®šä¹‰ä¸€ä¸ªæ•°ç»„ç±»å‹ï¼ˆä¹Ÿæ²¡æœ‰é€‰é¡¹å¯ä»¥å®šä¹‰ï¼‰ï¼Œæ˜ å°„ä¸ºä¸€ä¸ªæ™®é€šç±»å‹å³å¯ã€‚æ‰€æœ‰çš„æ ¸å¿ƒç±»å‹éƒ½æ”¯æŒæ•°ç»„ï¼Œæ— éœ€ä¿®æ”¹æ˜ å°„ï¼Œæ—¢å¯ä»¥ä½¿ç”¨å•ä¸€å€¼ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ã€‚å¯¹äºLuceneè€Œè¨€ï¼Œè¿™ä¸¤è€…åŸºæœ¬ä¸Šæ˜¯ä¸€è‡´çš„ï¼Œå› ä¸ºéƒ½æ˜¯åŸºäºåˆ†è¯çš„ï¼Œæ•°ç»„ä¹Ÿå°±æ˜¯ç›¸å½“äºå·²ç»é¢„å…ˆè¿›è¡Œäº†ä¸€éƒ¨åˆ†çš„åˆ†è¯ã€‚


### å¤šå­—æ®µç±»å‹


æ•°ç»„ç±»å‹å…è®¸ä¸€ç§ç±»å‹æœ‰å¤šä¸ªå€¼ï¼Œå¤šå­—æ®µç›¸å½“äºè®©ä¸€ä¸ªå­—æ®µæœ‰å¤šä¸ªç±»å‹ï¼Œå¯ä»¥å¯¹è¿™ä¸ªå­—æ®µçš„å€¼ç”¨ä¸åŒçš„ç±»å‹è¿›è¡Œç´¢å¼•ã€‚


```json
{    "properties": {        "tags": {            "type": "string",            "index": "analyzed",      "fields" : {        // ç¬¬äºŒä¸ªå­—ç¬¦tags.verbatimæ˜¯no_analyzedçš„        "verbatim" : {          "type": "string",          "index": "no_analyzed"        }      }        }    }}
```


### é¢„å®šä¹‰å­—æ®µ


é¢„å®šä¹‰å­—æ®µæ­ç¤ºäº†å­—æ®µç›¸å…³çš„åŠŸèƒ½å—ï¼Œå¹¶ä¸”æ€»æ˜¯ä»¥ä¸‹åˆ’çº¿`_`å¼€å¤´ã€‚

1. æ§åˆ¶å¦‚ä½•æœç´¢å’Œå­˜å‚¨æ–‡æ¡£

	`_source`åœ¨ç´¢å¼•æ–‡æ¡£çš„æ—¶å€™ï¼Œå­˜å‚¨åŸå§‹çš„JSONå­—æ–‡æ¡£ã€‚`_all`å°†æ‰€æœ‰å­—æ®µè¿›è¡Œç´¢å¼•ã€‚ä¸€ä¸ªæ˜¯åœ¨å†™å…¥æ–‡æ¡£çš„æ—¶å€™ï¼Œä¸€ä¸ªæ˜¯åœ¨æœç´¢æ–‡æ¡£çš„æ—¶å€™ã€‚ä¸æŒ‡å®šå­—æ®µåç§°è¿›è¡Œæœç´¢ä¼šåœ¨`_all`ä¸Šè¿›è¡Œæœç´¢ã€‚

2. å”¯ä¸€è¯†åˆ«æ–‡æ¡£

	ä¾‹å¦‚ï¼š`_uid` `_id` `_type` `_index`ã€‚ä¸ºäº†è¯†åˆ«åŒä¸€ä¸ªç´¢å¼•ä¸­çš„ä¸€ç¯‡æ–‡æ¡£ï¼ŒESä½¿ç”¨`_uid`æ¥æ ‡è¯†ï¼Œ`_uid`ç”±`_id`å’Œ`_type`å­—æ®µç»„æˆã€‚


	| å­—æ®µåç§°  | æ˜¯å¦å­˜å‚¨ | æ˜¯å¦ç´¢å¼•         | è§‚æµ‹                                                          |
	| ----- | ---- | ------------ | ----------------------------------------------------------- |
	| _uid  | æ˜¯    | æ˜¯            | ç”¨äºè¯†åˆ«ç´¢å¼•ä¸­çš„æŸç¯‡æ–‡æ¡£                                                |
	| _id   | å¦    | å¦            | æœç´¢å®ƒå®é™…ç”¨çš„æ˜¯`_uid`ï¼Œå±•ç¤ºä¹Ÿæ˜¯ä»`_uid`è·å–çš„                               |
	| _type | å¦    | not_analyzed | è¯¥å­—æ®µæ˜¯è¢«ç´¢å¼•çš„(å¯ç”¨äºè¿‡æ»¤æŸç§ç±»å‹çš„æ–‡æ¡£)ï¼Œå¹¶ä¸”ç”Ÿæˆä¸€ä¸ªå•ä¸€çš„è¯æ¡(æ²¡æœ‰åˆ†è¯åˆ†æ)ã€‚ES7.0ä¹‹åè¿™ä¸ªå­—æ®µåº”è¯¥æ²¡æœ‰äº† |

3. ä¸ºæ–‡æ¡£å¢åŠ æ–°çš„å±æ€§

	ä¾‹å¦‚ä½¿ç”¨`_size`æ¥ç´¢å¼•åŸå§‹JSONå†…å®¹çš„å¤§å°ï¼Œä½¿ç”¨`_timestamp`æ¥ç´¢å¼•æ–‡æ¡£ç´¢å¼•çš„æ—¶é—´ï¼Œç”¨`_ttl`å‘ŠçŸ¥ESæ–‡æ¡£è¿‡æœŸçš„æ—¶é—´ã€‚

4. æ§åˆ¶æ–‡æ¡£è·¯ç”±åˆ°å“ªäº›åˆ†ç‰‡

	ç›¸å…³å­—æ®µæ˜¯`_routing`å’Œ`_parent`


## ES Java API


### æ·»åŠ ä¾èµ–åŒ…


å¯¹äºåŸç”Ÿçš„springå·¥ç¨‹ï¼Œåˆ™å¼•å…¥ä»¥ä¸‹å¯¹åº”çš„åŒ…:


```xml
                <dependency>            <groupId>com.sankuai.meituan</groupId>            <artifactId>eagle-restclient</artifactId>            <version>1.2.24</version>        </dependency>        <dependency>            <groupId>com.sankuai.octo</groupId>            <artifactId>idl-common</artifactId>            <version>1.9.0</version>        </dependency>        <dependency>            <groupId>org.elasticsearch</groupId>            <artifactId>elasticsearch</artifactId>            <version>5.6.3</version>        </dependency>        <dependency>            <groupId>org.elasticsearch.client</groupId>            <artifactId>transport</artifactId>            <version>5.6.3</version>        </dependency>        <dependency>            <groupId>io.netty</groupId>            <artifactId>netty-all</artifactId>            <version>4.1.13.Final</version>        </dependency>        <dependency>            <groupId>io.netty</groupId>            <artifactId>netty</artifactId>            <version>3.10.6.Final</version>        </dependency>
```


### Rest Client


Java RESTå®¢æˆ·ç«¯æœ‰ä¸¤ç§é£æ ¼ï¼š

- Javaä½çº§åˆ«RESTå®¢æˆ·ç«¯ï¼ˆJava Low Level REST Clientï¼Œä»¥åéƒ½ç®€ç§°ä½çº§å®¢æˆ·ç«¯ç®—äº†ï¼Œéš¾å¾—ç å­—ï¼‰ï¼šElasticsearchçš„å®˜æ–¹low-levelå®¢æˆ·ç«¯ã€‚ å®ƒå…è®¸é€šè¿‡httpä¸Elasticsearché›†ç¾¤è¿›è¡Œé€šä¿¡ã€‚ ä¸ä¼šå¯¹è¯·æ±‚è¿›è¡Œç¼–ç å’Œå“åº”è§£ç ã€‚ å®ƒä¸æ‰€æœ‰Elasticsearchç‰ˆæœ¬å…¼å®¹ã€‚
- Javaé«˜çº§RESTå®¢æˆ·ç«¯ï¼ˆJava High Level REST Clientï¼Œä»¥åéƒ½ç®€ç§°é«˜çº§å®¢æˆ·ç«¯ï¼‰ï¼šElasticsearchçš„å®˜æ–¹high-levelå®¢æˆ·ç«¯ã€‚ åŸºäºlow-levelå®¢æˆ·ç«¯ï¼Œå®ƒå…¬å¼€äº†APIç‰¹å®šçš„æ–¹æ³•,å¹¶è´Ÿè´£å¤„ç†ã€‚

### Java Low Level REST Client


æ–°å»ºä¸€ä¸ªJava Low Level REST Clientåªéœ€å‡ ä¸ªå‚æ•°


åˆå§‹åŒ–ï¼š


```java
RestClient restClient = RestClient.builder(        new HttpHost("localhost", 9200, "http"),        new HttpHost("localhost", 9201, "http")).build();
```


ä¹Ÿå¯è®¾ç½®ç›¸å…³å‚æ•°ï¼š


```java
RestClientBuilder builder = RestClient.builder(new HttpHost("localhost", 9200, "http"));// è®¾ç½®HTTPè¯·æ±‚å¤´çš„é”®å€¼å¯¹Header[] defaultHeaders = new Header[]{new BasicHeader("header", "value")};builder.setDefaultHeaders(defaultHeaders);// è®¾ç½®è¶…æ—¶æ—¶é—´builder.setMaxRetryTimeoutMillis(10000);// è®¾ç½®å¤±è´¥å›è°ƒå‡½æ•°builder.setFailureListener(new RestClient.FailureListener() {    @Override    public void onFailure(HttpHost host) {    }});
```


å…³é—­ `RestClient`ï¼š


```java
restClient.close();
```


æœ€å¥½ä½¿ç”¨é«˜çº§åˆ«APIï¼Œå³Java High Level REST Clientã€‚


### Java High Level REST Client


åˆå§‹åŒ– `RestHighLevelClient`ï¼š


```java
RestClient lowLevelRestClient = RestClient.builder(        new HttpHost("localhost", 9200, "http"),        new HttpHost("localhost", 9201, "http")).build();
```


```java
RestHighLevelClient client =    new RestHighLevelClient(lowLevelRestClient);
```


åˆ›å»ºè¯·æ±‚


æ‰§è¡Œè¯·æ±‚


### æ–‡æ¡£æ›´æ–°


æ„é€ æ–‡æ¡£æ›´æ–°å†…å®¹ï¼š

1. jsonString
2. Map
3. XContentBuilder

### ScrollæŸ¥è¯¢


ES ScrollåŠŸèƒ½åˆå«åš**æ¸¸æ ‡æŸ¥è¯¢**ï¼Œè¯¥åŠŸèƒ½èƒ½å¤Ÿé«˜æ•ˆçš„éå†ESæŸ¥è¯¢çš„ç»“æœé›†ï¼Œä¸»è¦ç”¨äºè§£å†³ESæ™®é€šæŸ¥è¯¢æ·±åº¦ç¿»é¡µæ—¶çš„æ€§èƒ½é—®é¢˜ã€‚å› æ­¤ï¼ŒScrollåŠŸèƒ½å¸¸å¸¸ç”¨åœ¨**éå®æ—¶**åœºæ™¯ä¸‹æ£€ç´¢å¤§é‡ç»“æœï¼Œè¯¥åŠŸèƒ½æœ‰ä»¥ä¸‹ä¼˜ç¼ºç‚¹ï¼š

- ä¼˜ç‚¹ï¼šé’ˆå¯¹æ·±åº¦ç¿»é¡µåœºæ™¯ä¼˜åŒ–ï¼Œè·å–æ•°æ®çš„æ€§èƒ½æ¶ˆè€—æ—¶å›ºå®šçš„ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¸ä¼šéšç€é¡µæ•°å¢å¤šè€Œæ€¥å‰§ä¸‹é™ï¼›
- ç¼ºç‚¹ï¼šScrollåŠŸèƒ½æ˜¯æœ‰çŠ¶æ€çš„ï¼ŒESæœåŠ¡ç«¯ä¼šæ ¹æ®Scroll IDç»´æŒç¿»é¡µçŠ¶æ€ï¼Œéœ€è¦æ ¹æ®Scroll IDé¡ºåºç¿»é¡µï¼ˆç±»ä¼¼æ•°æ®åº“æ¸¸æ ‡ï¼‰ï¼ŒScrollç¿»é¡µè¿‡ç¨‹ä¸­ï¼Œæ–°çš„æ•°æ®å˜æ›´ä¸ä¼šä½“ç°åˆ°è¿”å›çš„ç»“æœé›†ä¸­ï¼Œä¸é€‚åˆå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åœºæ™¯ï¼›

çŸ¥é“äº†Scrollçš„åº”ç”¨åœºæ™¯åŠä¼˜ç¼ºç‚¹ï¼Œæˆ‘ä»¬å…ˆæ¥åˆ†æä¸‹å¸¸è§„ESæŸ¥è¯¢æ·±åº¦ç¿»é¡µä¸ºä»€ä¹ˆä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚


åŸç†


æ·±åº¦ç¿»é¡µæœ€ä¸»è¦çš„ç“¶é¢ˆåœ¨äºQueryé˜¶æ®µï¼ŒQueryé˜¶æ®µæ€»å…±éœ€è¦ä»NodeèŠ‚ç‚¹è·å–nodeNum *ï¼ˆfrom + sizeï¼‰æ¡æ•°æ®çš„doc_idå’Œè¯„åˆ†ï¼Œè¿™äº›è®°å½•åœ¨Coordinate Nodeæ’åºåï¼Œç»å¤§éƒ¨åˆ†æ•°æ®ä¼šè¢«ä¸¢å¼ƒï¼Œåªä½¿ç”¨æœ€åæ»¡è¶³æ¡ä»¶çš„sizeä¸ªdoc_idã€‚æ‰€ä»¥ï¼Œéšç€é¡µå·çš„å¢å¤§ï¼Œæ€§èƒ½ä¸»è¦æ¶ˆè€—åœ¨ä¸éœ€è¦çš„æ•°æ®ä¸Šï¼ŒES Scrollå°±æ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æŠ˜ä¸­æ–¹æ¡ˆï¼Œåœ¨ä½¿ç”¨Scroll APIæ—¶ï¼ŒESä¼šåœ¨æœåŠ¡ç«¯è®°å½•ä¸€ä¸ªæ¸¸æ ‡ï¼Œæ¯æ¬¡æŸ¥è¯¢æ—¶åªè·å–æ¸¸æ ‡ä¹‹åçš„sizeæ¡æ•°æ®ï¼Œè¿™æ ·å°±é¿å…äº†Queryé˜¶æ®µçš„æ—¶é—´æµªè´¹åœ¨ä¸éœ€è¦çš„æ•°æ®ä¸Šã€‚


## æœ¬åœ°å®è·µ


å®‰è£…ESï¼š


```shell
# å®‰è£…esbrew install elasticsearch# å®‰è£…æˆåŠŸåï¼ŒæŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯elasticsearch --version
```


å¯åŠ¨ESï¼š


```java
elasticsearch
```


æµè§ˆå™¨è¾“å…¥http://localhost:9200/ å³å¯è¿›å…¥æœ¬åœ°ES


![](https://raw.githubusercontent.com/redisread/Image/master/notionimg/ea/a6/eaa69a3ca704ab79280b69d90d4eed07.png)


è¿›å…¥ES


å®‰è£…Kibana


```shell
brew install kibana
```


å¯åŠ¨kibana


```shell
kibana
```


![](https://raw.githubusercontent.com/redisread/Image/master/notionimg/9d/e6/9de699d6ec2cc558653e92d29beae6b6.png)


image-20211101170215334


æ·»åŠ æµ‹è¯•æ•°æ®è¿›è¡Œå®è·µï¼š


![](https://raw.githubusercontent.com/redisread/Image/master/notionimg/e5/6f/e56fbfee502d57cfe98aa3f713af3396.png)


image-20211101170333713


## é—®é¢˜

1. ElasticSearch termæŸ¥è¯¢æœç´¢ä¸åˆ°æŒ‡å®šçš„æ•°æ® https://blog.csdn.net/qq_26531719/article/details/107029198
	- matchè¡¨ç¤ºå…¨æ–‡æœç´¢ï¼Œé€šå¸¸ç”¨äºå¯¹textç±»å‹å­—æ®µçš„æŸ¥è¯¢,ä¼šå¯¹è¿›è¡ŒæŸ¥è¯¢çš„æ–‡æœ¬å…ˆè¿›è¡Œåˆ†è¯æ“ä½œ
	- termè¡¨ç¤ºç²¾ç¡®æœç´¢ï¼Œé€šå¸¸ç”¨äºå¯¹keywordå’Œæœ‰ç²¾ç¡®å€¼çš„å­—æ®µè¿›è¡ŒæŸ¥è¯¢,ä¸ä¼šå¯¹è¿›è¡ŒæŸ¥è¯¢çš„æ–‡æœ¬è¿›è¡Œåˆ†è¯æ“ä½œ
2. 

---


_**Referenceï¼š**_

1. [ES5.6å®˜æ–¹æ–‡æ¡£-æ”¯æŒå¤šä¸ªç´¢å¼•å‚æ•°](https://www.elastic.co/guide/en/elasticsearch/reference/5.6/multi-index.html#multi-index)
2. [ES5.6å®˜æ–¹æ–‡æ¡£å…¬å…±å‚æ•°è®¾ç½®](https://www.elastic.co/guide/en/elasticsearch/reference/5.6/common-options.html)
3. [RestHighLevelClient-JavaDoc](https://artifacts.elastic.co/javadoc/org/elasticsearch/client/elasticsearch-rest-high-level-client/5.6.16/index.html)
4. [ES5.6-æ–‡æ¡£è¯»å†™åŸç†](https://www.elastic.co/guide/en/elasticsearch/reference/5.6/docs-replication.html)
5. [ElasticSearchæ ¹æ®åŒ¹é…æŸä¸ªæ¡ä»¶ï¼Œå±€éƒ¨æ›´æ–°æ–‡æ¡£_wessiyearçš„åšå®¢-CSDNåšå®¢_elasticsearchæ ¹æ®æ¡ä»¶æ›´æ–°](https://blog.csdn.net/wessiyear/article/details/78964383)
6. [Elasticsearchæ•™ç¨‹(29) update by queryçš„Scriptè„šæ­¥æ›´æ–° Java API æ”¯æŒes5.6 es6.8 es7.8_å†ä¹Ÿä¸ä¼šç©äºšç‘Ÿï¼Œå†ä¹Ÿä¸ä¼šèµ°åœ¨é‚£å¯¹æŠ—è·¯ä¸Š-CSDNåšå®¢](https://blog.csdn.net/winterking3/article/details/114031865)
7. [ã€ESã€‘ã€Java High Level REST Clientã€‘å®˜æ–¹ç´¢å¼•å’Œæ–‡æ¡£æ“ä½œæŒ‡å¯¼ - é£åŠ¨é™æ³‰ - åšå®¢å›­](https://www.cnblogs.com/z00377750/p/13300196.html)
8. [å…³äº ElasticSearchçš„Update By Query - akamiiyaçš„ç¨‹åºå‘˜ä¹‹è·¯](https://www.laizeh.com/2021/06/13/%E5%85%B3%E4%BA%8E-ElasticSearch%E7%9A%84Update-By-Query.html)
9. [Elasticsearchå»é‡æŸ¥è¯¢_jacklifeçš„åšå®¢-CSDNåšå®¢_eså»é‡æŸ¥è¯¢](https://blog.csdn.net/wslyk606/article/details/84315862)
10. [ES 15 - Elasticsearchçš„æ•°æ®ç±»å‹ (textã€keywordã€dateã€objectã€geoç­‰) - ç˜¦é£ - åšå®¢å›­](https://www.cnblogs.com/shoufeng/p/10692113.html)

