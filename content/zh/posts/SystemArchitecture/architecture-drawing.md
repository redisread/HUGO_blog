---
title: 架构制图
date: 2021-10-19T17:05:32+08:00
description: 如何做好系统设计，架构制图是重要的一环。
draft: false
hideToc: false
enableToc: true
enableTocContent: false
tocPosition: outer
author: Victor
authorEmoji: 🪶
image: https://cos.jiahongw.com/uPic/sketch.png
plantuml: true
libraries:
- katex
- mathjax
tags:
- 架构
series:
- 架构
categories:
-
---





<!--《软件架构制图方法论》-->

### 什么是软件架构

软件架构的三种定义：

1. 维基百科：软件架构可以和**建筑物的架构**相比拟。软件架构是构建计算机，开发系统以及计划进行的基础，可以列出开发团队的需要完成的任务。
2. IEEE：架构是环境中该系统一组基础概念和属性，具体表现是它的元素、关系，以及设计演进的基本原则。
3. 《clean  architecture》：架构是创建者给予该系统的形态（shape）。这个形态的具体形式来源于对系统组件（components）的划分和排列，以及这些组件之间互相通讯的方式。

> 架构体现的是一个整体的结构，以及组件（元素）之间的关系。



#### 软件架构的要素

- 元素：将系统拆分为一组元素（模块、组件、结构体、子系统）
- 属性：每个元素具备的属性（名称、职责、接口、实现限制等）
- 关系：不同元素之间的关系（交互、依赖、继承、组合、聚合）
- 原理：为什么这么设计（拆分依据、设计原则、决策原因等）





#### 架构域分类（TOGAF）

4A架构

![架构域分类](https://cos.jiahongw.com/uPic/image-20211024141736163.png)



业务架构图：

- 商业模式画布
- 业务能力图
- 价值流 + 业务能力 + 热点图
- 用例图
- 价值链图
- 流程图





数据架构图：

数据库：ES、Redis、MySQL、Tail





其中：

- 业务架构是软件架构的灵魂。有业务架构才有技术架构。

  业务架构是一种对组织如何利用其基本能力实现其战略意图和目标的正式描述。

- 应用架构是系统设计的顶层。

  应用架构是一组应用系统及其交互关系的描述，其中的每个应用系统都是一个**逻辑功能组**，用于支撑业务功能、管理数据资产。只关注支持业务和处理数据需要那些应用系统，不关注应用本身的架构和实现的技术。

- 数据架构是数据资产管理蓝图。

  数据架构定义了用来支持业务的各种数据，以及他们之间的关系，关注点是持久化数据的组织。关注点在：系统需要什么数据、数据间有什么关系、如何存储这些数据

- 技术架构是比特世界的布局。

  技术架构是将产品需求转变为技术实现的过程。关注点在于识别技术需求、技术选型、非功能性需求设计。



架构师也分为多种，有业务架构师和技术架构师。在开发一套系统的时候，首先是由公司管理层定下一个战略，然后业务架构师根据战略绘制业务架构图，然后技术架构师拿到业务架构图，进行识别技术需求和技术选型，编写出技术架构图，若还有数据架构师和应用架构师，那么也是在技术架构生成之前要设计相关的数据架构和应用架构，总之，技术架构总是在最后一步进行设计，而业务架构总是在前面设计。

![架构关系](https://cos.jiahongw.com/uPic/image-20211024144709834.png)





### 为什么需要软件架构图



> 两种开发流程：
>
> 1. 瀑布流程。
> 2. 迭代流程



- 架构是系统实现的蓝图。

- 架构是沟通协作的桥梁。

- 架构是产品质量的基础。



重要在哪：

- 促进协作
- 增强沟通
- 描绘愿景
- 提供指导





#### 描述架构的方式

- 文字（标准、详尽、易于版本管理）
- 图（直观、形象、表达能力强）



尽管人们日常的工作场所大多是语言性或非图示化的（口语、文字和数字等），但事实上人脑的80%功能都是用于处理视觉信息的，人们对接受视觉信息具有天生的敏感度。——罗伯特-豪恩《VisualLanguage》



**最好使用图来描述架构。**



### 如何画软件架构图

- “法”：架构设计原则&模式
- “术”：常用制图方法
- “器”：常用制图工具
- “道”：架构制图方法论



#### “法”：架构设计原则&模式

- SOLID原则
- 设计模式原则
- 架构模式（C/S模式、主从模式、管道模式、微服务模式、云原生模式）
- 设计模式（观察者模式...）



常见的架构模式设计图：

MVC架构：

![MVC架构](https://cos.jiahongw.com/uPic/image-20211024151447740.png)



分层架构：

![分层架构](https://cos.jiahongw.com/uPic/image-20211024151718696.png)



微服务架构：

![微服务架构](https://cos.jiahongw.com/uPic/70.jpeg)



洋葱架构：

![洋葱架构](https://cos.jiahongw.com/uPic/v2-58fcd9a2f3b70e48804e03de98b59fea_r.jpg)



微内核架构：

![Alt 微内核架构](https://cos.jiahongw.com/uPic/1030-1.png)

还有事务驱动架构、云化架构、六边形架构。



#### “术”：常用制图方法



##### UML

统一建模语言（Unified Modeling Language，缩写UML）是一种用于说明、可视化、构建和编写一个正在开发的、面向对象的、软件密集系统的制品的开放方法。UML在对大规模，复杂系统进行建模方面，特别是在软件架构层次已经被验证有效。

主要模型：

- 功能模型：用例图
- 对象模型：类图
- 动态模型：时序图、活动图、状态图

> UML的学习成本有点高。



##### 4+1ViewModel

哪四个视图？

1. 逻辑视图：关注系统提供给终端用户的功能，一般会通过UML中的类图和状态图来表示
2. 流程视图：关注系统的动态部分、运行时行为，包括系统的执行流程和交互方式，一般会通过UML中的时序图、活动图和通讯图来表示。
3. 开发视图：也称为实现视图，以程序员视角阐述系统的组件等，一般会通过UML中的组件图和包图来表示。
4. 物理视图：也称为部署视图，以系统工程师角度描述系统各组件在物理层的拓扑，一般会通过UML中的部署图来表示。



哪一个场景？

**场景**：也称为用例视图，通过一组用例（场景）描述系统中对象和流程之间的交互与时序。

> 实际是一种模型，不限制使用哪种方法实现。



##### C4Model

- **第 1 层：系统上下文图（System Context diagram）**

  在这一层级中细节并不重要，只需要显示系统概况。 重点应该放在人员（角色）和软件系统上，而不是技术，协议和其他低层级细节上，从而使非技术人员也能够看得懂。这个图也是明确需求的重要图示。

  ![系统上下文](https://cos.jiahongw.com/uPic/webp.jpg)

- **第 2 层：容器图（Container diagram）**

  “容器”类似于服务器端Web应用程序，单页应用程序，桌面应用程序，移动应用程序，数据库架构，文件系统等。本质上，容器是可单独运行/可部署的单元（例如，单独的进程空间） ）执行代码或存储数据。容器图显示了软件体系结构的高层结构以及如何在其间分配职责。 它还显示了主要的技术选择以及容器之间的通信方式。

  ![容器图](https://cos.jiahongw.com/uPic/webp-20211024154440583.jpg)

- **第 3 层：组件图（Component diagram）**

  组件图显示了容器如何由多个“组件”组成，每个组件是什么，它们的职责以及技术/实现接口（API）或者细节。

  ![组件图](https://cos.jiahongw.com/uPic/webp-20211024154451053.jpg)

- **第 4层：（Code）**

  这一层是可选的，可以使用UML类图，实体关系图或类似的图。理想情况下，该图可以使用工具（例如IDE或UML建模工具）自动生成。

关键思想：

- 自顶向下对系统的静态结构进行逐级拆分，描述各层次对象的职责、关系和外部依赖。
- 对于关键链路，使用动态视图描述运行时的交互行为和时序关系。
- 面向部署实施，使用部署视图描述系统逻辑节点与物理资源之间的映射关系。



#### “器”：常用制图工具



可视化制图工具有这些：

- draw.io
- ProcessOn
- Visio



代码化制图：

- PlantUML
- Structurizr
- Graphviz



#### “道”：架构制图方法论

什么是一张好的架构图？

- 准确：错的图比没有图还糟糕
- 完整：覆盖架构的核心要素和关键信息
- 清晰：清晰的图例（形状、颜色、箭头）、标注（内部系统or外部依赖）
- 一致：同一类型的图，使用相同的记号风格
- 简洁：不要企图用一张图讲清楚所有，化繁为简，更容易被理解

